<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dimensional Typography</title>
    <style>
        @font-face {
            font-family: 'Menlo';
            src: local('Menlo'), local('Menlo Regular');
            font-weight: normal;
            font-style: normal;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        :root {
            --text-primary: rgba(230, 230, 240, 0.94);
            --text-secondary: rgba(200, 200, 220, 0.85);
            --text-tertiary: rgba(170, 170, 190, 0.75);
            --accent-cyan: rgba(120, 210, 255, 0.9);
            --accent-mint: rgba(150, 255, 180, 0.9);
            --accent-gold: rgba(255, 200, 120, 0.9);
            --accent-magenta: rgba(255, 150, 220, 0.9);
            --glow-cyan: rgba(100, 200, 255, 0.4);
            --glow-mint: rgba(100, 255, 180, 0.4);
            --glow-gold: rgba(255, 200, 100, 0.4);
            --glow-magenta: rgba(255, 150, 220, 0.4);
            --bg-primary: #0a0a12;
            --bg-secondary: #12121e;
            --bg-tertiary: #1a1a2e;
            --depth-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            --depth-foreground: 8px;
            --depth-background: -8px;
            --transition-smooth: cubic-bezier(0.22, 1, 0.36, 1);
        }
        
        body {
            background-color: #000;
            color: var(--text-primary);
            font-family: 'Menlo', monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            height: 100vh;
            touch-action: manipulation;
        }
        
        .iphone-container {
            position: relative;
            width: 390px; /* iPhone 12/13/14 width */
            height: 844px; /* iPhone 12/13/14 height */
            overflow: hidden;
            background: linear-gradient(135deg, var(--bg-primary), var(--bg-tertiary));
            perspective: 1200px;
            perspective-origin: 50% 50%;
            border-radius: 40px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5),
                        0 10px 20px -5px rgba(0, 0, 0, 0.2),
                        inset 0 0 2px rgba(255, 255, 255, 0.05);
        }
        
        .text-scene {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            padding: 2.5rem 1.75rem;
            overflow: hidden;
            transition: transform 0.3s var(--transition-smooth);
        }
        
        .paragraph {
            position: relative;
            font-size: 17px;
            line-height: 1.7;
            transform-style: preserve-3d;
            margin-bottom: 1.8rem;
            letter-spacing: -0.01em;
            color: var(--text-primary);
            font-kerning: normal;
            text-rendering: optimizeLegibility;
            -webkit-font-smoothing: antialiased;
            width: calc(100% - 10px);
        }
        
        .word {
            display: inline-block;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.7s var(--transition-smooth),
                        text-shadow 0.7s var(--transition-smooth),
                        color 0.7s var(--transition-smooth);
            margin-right: 0.25em;
            white-space: nowrap;
            will-change: transform, text-shadow;
        }
        
        .foreground {
            transform: translateZ(var(--depth-foreground));
            color: var(--text-primary);
            text-shadow: 0 0 8px var(--glow-cyan);
            font-weight: 500;
        }
        
        .background {
            transform: translateZ(var(--depth-background));
            color: var(--text-tertiary);
            text-shadow: 0 0 0 transparent;
            font-weight: 300;
        }
        
        .original-text, .alternative-text {
            transition: opacity 0.4s var(--transition-smooth),
                        transform 0.4s var(--transition-smooth);
        }
        
        .alternative-text {
            position: absolute;
            top: 0;
            left: 0;
            opacity: 0;
            pointer-events: none;
            transform: translateY(5px);
        }
        
        .word.multi-substitution {
            color: var(--accent-cyan);
            text-shadow: 0 0 8px var(--glow-cyan);
            cursor: pointer;
            position: relative;
            border-bottom: 1px dotted rgba(120, 210, 255, 0.25);
            padding-bottom: 2px;
            transform: translateZ(4px);
            transition: all 0.3s var(--transition-smooth);
        }
        
        .word.multi-substitution:hover, .word.multi-substitution:active {
            color: var(--accent-cyan);
            text-shadow: 0 0 12px var(--glow-cyan);
            border-bottom-color: rgba(120, 210, 255, 0.6);
        }
        
        .foreign-text {
            position: relative;
            cursor: pointer;
            display: inline-block;
            line-height: 1.4;
            margin: 0.1em 0.4em;
            padding: 0.2em 0.4em;
            border-radius: 0.35em;
            transition: all 0.3s var(--transition-smooth);
            transform: translateZ(4px);
            transform-style: preserve-3d;
        }
        
        .foreign-text::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(30, 40, 60, 0.15);
            border-radius: 0.35em;
            z-index: -1;
            transition: all 0.3s var(--transition-smooth);
            transform: translateZ(-2px);
        }
        
        .foreign-text:hover::before, .foreign-text:active::before {
            background: rgba(40, 50, 80, 0.25);
        }
        
        .foreign-text.persian {
            font-family: 'Tahoma', sans-serif;
            color: var(--accent-gold);
            text-shadow: 0 0 8px var(--glow-gold);
            direction: rtl;
            font-size: 0.9em;
            padding: 0.25em 0.5em;
            line-height: 1.7;
        }
        
        .foreign-text.chinese {
            font-family: 'PingFang SC', 'SimSun', 'STSong', sans-serif;
            color: var(--accent-mint);
            text-shadow: 0 0 8px var(--glow-mint);
            font-size: 1.1em;
            font-weight: 400;
            letter-spacing: 0.05em;
        }
        
        .centered-poetry {
            text-align: center;
            margin: 2rem 0;
            transform-style: preserve-3d;
            transform: translateZ(6px);
        }
        
        .poetry-line {
            margin-bottom: 0.8rem;
            transform-style: preserve-3d;
            position: relative;
        }
        
        .translation-tooltip {
            position: absolute;
            background: rgba(15, 20, 35, 0.96);
            backdrop-filter: blur(10px);
            padding: 1rem;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3),
                        0 0 15px var(--glow-cyan),
                        inset 0 0 1px rgba(200, 220, 255, 0.2);
            font-size: 15px;
            line-height: 1.5;
            width: max-content;
            max-width: 300px;
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s var(--transition-smooth);
            transform: translateY(5px) scale(0.98);
            pointer-events: none;
            border: 1px solid rgba(100, 200, 255, 0.15);
            color: var(--text-primary);
        }
        
        .translation-tooltip.visible {
            opacity: 1;
            visibility: visible;
            transform: translateY(0) scale(1);
        }
        
        .translation-tooltip::after {
            content: '';
            position: absolute;
            top: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-bottom: 8px solid rgba(15, 20, 35, 0.9);
        }
        
        .translation-origin {
            font-size: 0.8em;
            margin-top: 0.5em;
            opacity: 0.7;
            font-style: italic;
        }
        
        .settings-panel {
            position: absolute;
            bottom: 2rem;
            right: 2rem;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            z-index: 100;
        }
        
        .settings-button {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(30, 40, 60, 0.8);
            backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-primary);
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2),
                        0 0 8px var(--glow-cyan);
            transition: all 0.3s var(--transition-smooth);
            border: 1px solid rgba(100, 200, 255, 0.15);
            font-size: 20px;
            will-change: transform, box-shadow;
        }
        
        .settings-button:hover, .settings-button:active {
            background: rgba(40, 60, 80, 0.9);
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3),
                        0 0 12px var(--glow-cyan);
        }
        
        .settings-panel-expanded {
            position: absolute;
            bottom: 5rem;
            right: 2rem;
            background: rgba(15, 20, 35, 0.95);
            backdrop-filter: blur(10px);
            padding: 1.5rem;
            border-radius: 16px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3),
                        0 0 20px var(--glow-cyan),
                        inset 0 0 2px rgba(200, 220, 255, 0.2);
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transform: translateY(20px) scale(0.95);
            transition: all 0.4s var(--transition-smooth);
            border: 1px solid rgba(100, 200, 255, 0.15);
            width: 300px;
        }
        
        .settings-panel-expanded.visible {
            opacity: 1;
            visibility: visible;
            transform: translateY(0) scale(1);
        }
        
        .settings-title {
            margin-bottom: 1.25rem;
            font-size: 17px;
            font-weight: bold;
            color: var(--text-primary);
            position: relative;
            padding-bottom: 0.5rem;
        }
        
        .settings-title::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 1px;
            background: linear-gradient(90deg, 
                var(--accent-cyan), 
                rgba(120, 210, 255, 0.2), 
                transparent);
        }
        
        .settings-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.25rem;
        }
        
        .settings-label {
            color: var(--text-secondary);
            font-size: 15px;
        }
        
        .slider-container {
            width: 120px;
            height: 20px;
            position: relative;
        }
        
        .slider {
            -webkit-appearance: none;
            width: 100%;
            height: 4px;
            border-radius: 2px;
            background: rgba(100, 200, 255, 0.2);
            outline: none;
            transition: all 0.2s ease;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--accent-cyan);
            cursor: pointer;
            box-shadow: 0 0 10px var(--glow-cyan);
            transition: all 0.2s ease;
        }
        
        .slider::-moz-range-thumb {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--accent-cyan);
            cursor: pointer;
            box-shadow: 0 0 10px var(--glow-cyan);
            border: none;
            transition: all 0.2s ease;
        }
        
        .slider::-webkit-slider-thumb:hover {
            transform: scale(1.1);
            box-shadow: 0 0 15px var(--glow-cyan);
        }
        
        .slider::-moz-range-thumb:hover {
            transform: scale(1.1);
            box-shadow: 0 0 15px var(--glow-cyan);
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 52px;
            height: 26px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(100, 200, 255, 0.2);
            transition: .4s var(--transition-smooth);
            border-radius: 26px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: #fff;
            transition: .4s var(--transition-smooth);
            border-radius: 50%;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
        }
        
        input:checked + .toggle-slider {
            background-color: var(--accent-cyan);
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }
        
        input:focus + .toggle-slider {
            box-shadow: 0 0 5px var(--glow-cyan);
        }
        
        @keyframes pulse {
            0% {
                text-shadow: 0 0 8px var(--glow-cyan);
            }
            50% {
                text-shadow: 0 0 15px var(--glow-cyan);
            }
            100% {
                text-shadow: 0 0 8px var(--glow-cyan);
            }
        }
        
        @keyframes float {
            0%, 100% {
                transform: translateZ(var(--depth-foreground)) translateY(0);
            }
            50% {
                transform: translateZ(var(--depth-foreground)) translateY(-3px);
            }
        }
        
        .floating {
            animation: float 8s infinite ease-in-out;
        }
        
        .pulse-glow {
            animation: pulse 6s infinite ease-in-out;
        }
        
        .gradient-text {
            background: linear-gradient(90deg, var(--accent-cyan), var(--accent-magenta));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            color: transparent;
            transform: translateZ(2px);
        }
        
        /* Reading cursor */
        .reading-cursor {
            position: absolute;
            width: 2px;
            height: 24px;
            background: var(--accent-cyan);
            border-radius: 1px;
            opacity: 0.7;
            pointer-events: none;
            mix-blend-mode: screen;
            box-shadow: 0 0 8px var(--glow-cyan);
            z-index: 5;
            transform: translateZ(10px);
            transition: opacity 0.3s ease, transform 0.2s ease;
        }
        
        .reading-cursor.hidden {
            opacity: 0;
        }
        
        /* Tap feedback */
        .tap-feedback {
            position: absolute;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: radial-gradient(circle, var(--glow-cyan), transparent 70%);
            opacity: 0;
            pointer-events: none;
            z-index: 10;
            transform: translate(-50%, -50%);
            mix-blend-mode: screen;
        }
        
        @keyframes tap-ripple {
            0% {
                transform: translate(-50%, -50%) scale(0.5);
                opacity: 0.8;
            }
            100% {
                transform: translate(-50%, -50%) scale(2);
                opacity: 0;
            }
        }
        
        /* Fine typography adjustments */
        .word-group {
            display: inline-block;
            margin-right: 0.1em;
            white-space: nowrap;
        }
        
        .tight-space {
            margin-right: 0.05em;
        }
        
        .no-break {
            white-space: nowrap;
        }
        
        /* Refined visual markers */
        .subtitle-line {
            font-size: 0.85em;
            color: var(--text-tertiary);
            margin-bottom: 1.4rem;
            margin-top: -1rem;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            transform: translateZ(2px);
        }
        
        /* Accessibility focus states */
        .word:focus-visible, .foreign-text:focus-visible {
            outline: 2px solid var(--accent-cyan);
            outline-offset: 2px;
            border-radius: 4px;
        }
        
        /* Semantic neighborhood visualization */
        .semantic-map {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(5, 10, 20, 0.85);
            backdrop-filter: blur(10px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.4s var(--transition-smooth), visibility 0.4s var(--transition-smooth);
        }
        
        .semantic-map.visible {
            opacity: 1;
            visibility: visible;
        }
        
        .semantic-map-inner {
            width: 90%;
            height: 90%;
            max-width: 350px;
            max-height: 600px;
            background: rgba(20, 30, 50, 0.9);
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            border: 1px solid var(--accent-cyan);
            box-shadow: 0 0 30px rgba(100, 200, 255, 0.3);
            overflow: hidden;
        }
        
        .semantic-map-title {
            padding: 1rem;
            text-align: center;
            font-size: 18px;
            font-weight: 500;
            color: var(--text-primary);
            border-bottom: 1px solid rgba(100, 200, 255, 0.2);
            background: rgba(30, 40, 60, 0.8);
        }
        
        .semantic-map-content {
            flex: 1;
            padding: 1rem;
            overflow: hidden;
            position: relative;
        }
        
        .semantic-map-footer {
            padding: 1rem;
            display: flex;
            justify-content: center;
            border-top: 1px solid rgba(100, 200, 255, 0.2);
        }
        
        .semantic-map-footer button {
            background: rgba(100, 200, 255, 0.2);
            border: 1px solid rgba(100, 200, 255, 0.4);
            color: var(--text-primary);
            padding: 0.6rem 2rem;
            border-radius: 30px;
            font-family: 'Menlo', monospace;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .semantic-map-footer button:hover {
            background: rgba(100, 200, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }
        
        .semantic-node {
            position: absolute;
            background: rgba(100, 200, 255, 0.1);
            border: 1px solid rgba(100, 200, 255, 0.3);
            color: var(--text-primary);
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 14px;
            transition: all 0.2s ease;
            cursor: pointer;
            text-align: center;
            transform: translate(-50%, -50%);
        }
        
        .semantic-node:hover {
            background: rgba(100, 200, 255, 0.2);
            transform: translate(-50%, -50%) scale(1.1);
            z-index: 10;
        }
        
        .semantic-node.central {
            background: rgba(100, 200, 255, 0.3);
            border: 2px solid rgba(100, 200, 255, 0.6);
            font-weight: bold;
            z-index: 5;
            padding: 8px 16px;
            font-size: 16px;
        }
        
        .semantic-node.selected {
            background: rgba(150, 255, 180, 0.3);
            border: 2px solid rgba(150, 255, 180, 0.6);
            color: var(--accent-mint);
            text-shadow: 0 0 8px var(--glow-mint);
        }
        
        /* Typography refinements for smaller screens */
        @media (max-width: 390px) {
            .paragraph {
                font-size: 16px;
                line-height: 1.6;
                margin-bottom: 1.6rem;
            }
            
            .foreign-text {
                font-size: 0.9em;
                padding: 0.15em 0.3em;
            }
            
            .settings-panel-expanded {
                width: 280px;
                right: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="iphone-container">
        <div class="text-scene" id="text-scene">
            <div class="reading-cursor hidden" id="reading-cursor"></div>
            
            <h1 class="paragraph" style="font-size: 22px; margin-bottom: 1rem; transform: translateZ(10px);">
                <span class="word gradient-text">Dimensional</span>
                <span class="word">Wisdom</span>
            </h1>
            
            <div class="subtitle-line">Ancient echoes across time and space</div>
            
            <p class="paragraph">
                <span class="word">In</span>
                <span class="word-group">
                    <span class="word">the</span>
                    <span class="word foreground pulse-glow">depths</span>
                </span>
                <span class="word">of</span>
                <span class="word background">perception,</span>
                <span class="word-group">
                    <span class="word">where</span>
                    <span class="word multi-substitution" id="word-1" tabindex="0" data-word="consciousness" 
                    data-alternatives="awareness,mindfulness,cognition,sentience,wakefulness,presence,attention,perception,recognition,understanding">
                        <span class="current-text">consciousness</span>
                    </span>
                </span>
                <span class="word foreground floating">flows</span>
                <span class="word-group tight-space">
                    <span class="word">like</span>
                    <span class="word background">water,</span>
                </span>
                <span class="word-group">
                    <span class="word">we</span>
                    <span class="word">discover</span>
                </span>
                <span class="word">the</span>
                <span class="word gradient-text">essence</span>
                <span class="word">of</span>
                <span class="word">being.</span>
            </p>
            
            <div class="centered-poetry">
                <div class="poetry-line">
                    <span class="foreign-text chinese" data-translation="The Way that can be told is not the eternal Way" data-source="Tao Te Ching, Chapter 1" tabindex="0">道可道，非常道</span>
                </div>
                <div class="poetry-line">
                    <span class="foreign-text chinese" data-translation="The name that can be named is not the eternal name" data-source="Tao Te Ching, Chapter 1" tabindex="0">名可名，非常名</span>
                </div>
                <div class="poetry-line">
                    <span class="foreign-text chinese" data-translation="The nameless is the origin of Heaven and Earth" data-source="Tao Te Ching, Chapter 1" tabindex="0">無名天地之始</span>
                </div>
                <div class="poetry-line">
                    <span class="foreign-text chinese" data-translation="The named is the mother of all things" data-source="Tao Te Ching, Chapter 1" tabindex="0">有名萬物之母</span>
                </div>
            </div>
            
            <p class="paragraph">
                <span class="word-group">
                    <span class="word">Laozi</span>
                    <span class="word background">reminds</span>
                    <span class="word">us</span>
                </span>
                <span class="word">that</span>
                <span class="word multi-substitution" id="word-2" tabindex="0" data-word="truth" 
                data-alternatives="reality,essence,nature,being,existence,actuality,verity,substance,authenticity,certainty">
                    <span class="current-text">truth</span>
                </span>
                <span class="word">exists</span>
                <span class="word">beyond</span>
                <span class="word">language,</span>
                <span class="word">beyond</span>
                <span class="word-group">
                    <span class="word">our</span>
                    <span class="word foreground pulse-glow">comprehension.</span>
                </span>
                <span class="word">The</span>
                <span class="word multi-substitution" id="word-3" tabindex="0" data-word="mysteries" 
                data-alternatives="secrets,enigmas,riddles,puzzles,conundrums,paradoxes,unknowns,arcana,wonders,phenomena">
                    <span class="current-text">mysteries</span>
                </span>
                <span class="word">of</span>
                <span class="word background">existence</span>
                <span class="word">remain</span>
                <span class="word-group">
                    <span class="word">beyond</span>
                    <span class="word">words.</span>
                </span>
            </p>
            
            <div class="centered-poetry">
                <div class="poetry-line">
                    <span class="foreign-text persian" data-translation="Beyond ideas of wrongdoing and rightdoing there is a field." data-source="Jalal ad-Din Muhammad Rumi, Masnavi" tabindex="0">آن سوی اندیشه‌های بد و خوب، دشتی است</span>
                </div>
                <div class="poetry-line">
                    <span class="foreign-text persian" data-translation="I'll meet you there. When the soul lies down in that grass" data-source="Jalal ad-Din Muhammad Rumi, Masnavi" tabindex="0">آنجا با تو دی<body>
    <div class="iphone-container">
        <div class="text-scene" id="text-scene">
            <div class="reading-cursor hidden" id="reading-cursor"></div>
            
            <h1 class="paragraph" style="font-size: 22px; margin-bottom: 1rem; transform: translateZ(10px);">
                <span class="word gradient-text">Dimensional</span>
                <span class="word">Wisdom</span>
            </h1>
            
            <div class="subtitle-line">Ancient echoes across time and space</div>
            
            <p class="paragraph">
                <span class="word">In</span>
                <span class="word-group">
                    <span class="word">the</span>
                    <span class="word foreground pulse-glow">depths</span>
                </span>
                <span class="word">of</span>
                <span class="word background">perception,</span>
                <span class="word-group">
                    <span class="word">where</span>
                    <span class="word multi-substitution" id="word-1" tabindex="0" data-word="consciousness" 
                    data-alternatives="awareness,mindfulness,cognition,sentience,wakefulness,presence,attention,perception,recognition,understanding">
                        <span class="current-text">consciousness</span>
                    </span>
                </span>
                <span class="word foreground floating">flows</span>
                <span class="word-group tight-space">
                    <span class="word">like</span>
                    <span class="word background">water,</span>
                </span>
                <span class="word-group">
                    <span class="word">we</span>
                    <span class="word">discover</span>
                </span>
                <span class="word">the</span>
                <span class="word gradient-text">essence</span>
                <span class="word">of</span>
                <span class="word">being.</span>
            </p>
            
            <div class="centered-poetry">
                <div class="poetry-line">
                    <span class="foreign-text chinese" data-translation="The Way that can be told is not the eternal Way" data-source="Tao Te Ching, Chapter 1" tabindex="0">道可道，非常道</span>
                </div>
                <div class="poetry-line">
                    <span class="foreign-text chinese" data-translation="The name that can be named is not the eternal name" data-source="Tao Te Ching, Chapter 1" tabindex="0">名可名，非常名</span>
                </div>
                <div class="poetry-line">
                    <span class="foreign-text chinese" data-translation="The nameless is the origin of Heaven and Earth" data-source="Tao Te Ching, Chapter 1" tabindex="0">無名天地之始</span>
                </div>
                <div class="poetry-line">
                    <span class="foreign-text chinese" data-translation="The named is the mother of all things" data-source="Tao Te Ching, Chapter 1" tabindex="0">有名萬物之母</span>
                </div>
            </div>
            
            <p class="paragraph">
                <span class="word-group">
                    <span class="word">Laozi</span>
                    <span class="word background">reminds</span>
                    <span class="word">us</span>
                </span>
                <span class="word">that</span>
                <span class="word multi-substitution" id="word-2" tabindex="0" data-word="truth" 
                data-alternatives="reality,essence,nature,being,existence,actuality,verity,substance,authenticity,certainty">
                    <span class="current-text">truth</span>
                </span>
                <span class="word">exists</span>
                <span class="word">beyond</span>
                <span class="word">language,</span>
                <span class="word">beyond</span>
                <span class="word-group">
                    <span class="word">our</span>
                    <span class="word foreground pulse-glow">comprehension.</span>
                </span>
                <span class="word">The</span>
                <span class="word multi-substitution" id="word-3" tabindex="0" data-word="mysteries" 
                data-alternatives="secrets,enigmas,riddles,puzzles,conundrums,paradoxes,unknowns,arcana,wonders,phenomena">
                    <span class="current-text">mysteries</span>
                </span>
                <span class="word">of</span>
                <span class="word background">existence</span>
                <span class="word">remain</span>
                <span class="word-group">
                    <span class="word">beyond</span>
                    <span class="word">words.</span>
                </span>
            </p>
            
            <div class="centered-poetry">
                <div class="poetry-line">
                    <span class="foreign-text persian" data-translation="Beyond ideas of wrongdoing and rightdoing there is a field." data-source="Jalal ad-Din Muhammad Rumi, Masnavi" tabindex="0">آن سوی اندیشه‌های بد و خوب، دشتی است</span>
                </div>
                <div class="poetry-line">
                    <span class="foreign-text persian" data-translation="I'll meet you there. When the soul lies down in that grass" data-source="Jalal ad-Din Muhammad Rumi, Masnavi" tabindex="0">آنجا با تو دیدار می‌کنم. آنجا که روح در آن چمن می‌آرامد</span>
                </div>
                <div class="poetry-line">
                    <span class="foreign-text persian" data-translation="The world is too full to talk about. Ideas, language, even the phrase 'each other'" data-source="Jalal ad-Din Muhammad Rumi, Masnavi" tabindex="0">جهان برای گفتن پر است. اندیشه‌ها، زبان، حتی عبارت 'یکدیگر'</span>
                </div>
                <div class="poetry-line">
                    <span class="foreign-text persian" data-translation="Doesn't make any sense." data-source="Jalal ad-Din Muhammad Rumi, Masnavi" tabindex="0">هیچ معنایی ندارد</span>
                </div>
            </div>
            
            <p class="paragraph">
                <span class="word-group">
                    <span class="word">And</span>
                    <span class="word background">Rumi</span>
                </span>
                <span class="word">beckons</span>
                <span class="word">us</span>
                <span class="word">to</span>
                <span class="word foreground floating">transcend</span>
                <span class="word">our</span>
                <span class="word-group">
                    <span class="word">limited</span>
                    <span class="word">perspective,</span>
                </span>
                <span class="word">to</span>
                <span class="word">find</span>
                <span class="word">that</span>
                <span class="word gradient-text">field</span>
                <span class="word">beyond</span>
                <span class="word multi-substitution" id="word-4" tabindex="0" data-word="judgment" 
                data-alternatives="duality,polarization,conflict,discrimination,comparison,evaluation,assessment,critique,division,separation">
                    <span class="current-text">judgment</span>
                </span>
                <span class="word">where</span>
                <span class="word-group">
                    <span class="word">true</span>
                    <span class="word background">connection</span>
                </span>
                <span class="word">becomes</span>
                <span class="word">possible.</span>
            </p>
            
            <div class="centered-poetry">
                <div class="poetry-line">
                    <span class="foreign-text chinese" data-translation="Between being and non-being, the only difference is in name" data-source="Zhuangzi" tabindex="0">有無之間，其名為差</span>
                </div>
                <div class="poetry-line">
                    <span class="foreign-text chinese" data-translation="Once I dreamt I was a butterfly, now I wonder if I am a butterfly dreaming I'm a man" data-source="Zhuangzi" tabindex="0">昔者莊周夢為蝴蝶，今者蝴蝶夢為莊周</span>
                </div>
            </div>
            
            <p class="paragraph">
                <span class="word-group">
                    <span class="word">Each</span>
                    <span class="word">tradition</span>
                </span>
                <span class="word">points</span>
                <span class="word">to</span>
                <span class="word-group">
                    <span class="word">the</span>
                    <span class="word foreground">ineffable</span>
                </span>
                <span class="word">nature</span>
                <span class="word">of</span>
                <span class="word-group">
                    <span class="word background">reality,</span>
                </span>
                <span class="word">where</span>
                <span class="word multi-substitution" id="word-5" tabindex="0" data-word="boundaries" 
                data-alternatives="distinctions,divisions,separations,demarcations,limits,borders,confines,delineations,thresholds,partitions">
                    <span class="current-text">boundaries</span>
                </span>
                <span class="word">dissolve</span>
                <span class="word">and</span>
                <span class="word">the</span>
                <span class="word gradient-text">observer</span>
                <span class="word">becomes</span>
                <span class="word">the</span>
                <span class="word foreground floating">observed.</span>
            </p>
            
            <div class="centered-poetry">
                <div class="poetry-line">
                    <span class="foreign-text persian" data-translation="You are not a drop in the ocean. You are the entire ocean in a drop." data-source="Jalal ad-Din Muhammad Rumi" tabindex="0">تو قطره‌ای در اقیانوس نیستی، تو تمام اقیانوس در یک قطره هستی</span>
                </div>
                <div class="poetry-line">
                    <span class="foreign-text persian" data-translation="What you seek is seeking you." data-source="Jalal ad-Din Muhammad Rumi" tabindex="0">آنچه می‌جویی، جویای توست</span>
                </div>
                <div class="poetry-line">
                    <span class="foreign-text persian" data-translation="Let yourself be silently drawn by the strange pull of what you really love." data-source="Jalal ad-Din Muhammad Rumi" tabindex="0">بگذار خاموشانه جذب کششِ عجیبِ آنچه واقعاً دوستش داری، شوی</span>
                </div>
            </div>
            
            <p class="paragraph">
                <span class="word">The</span>
                <span class="word-group">
                    <span class="word">ancient</span>
                    <span class="word background">wisdom</span>
                </span>
                <span class="word">of</span>
                <span class="word">both</span>
                <span class="word foreground">East</span>
                <span class="word">and</span>
                <span class="word foreground">West</span>
                <span class="word">converges</span>
                <span class="word">on</span>
                <span class="word">a</span>
                <span class="word-group">
                    <span class="word">profound</span>
                    <span class="word multi-substitution" id="word-6" tabindex="0" data-word="paradox" 
                    data-alternatives="mystery,enigma,contradiction,conundrum,riddle,dilemma,quandary,irony,incongruity,ambiguity">
                        <span class="current-text">paradox</span>
                    </span>
                </span>
                <span class="word">that</span>
                <span class="word">we</span>
                <span class="word">are</span>
                <span class="word-group">
                    <span class="word">both</span>
                    <span class="word background">separate</span>
                </span>
                <span class="word-group">
                    <span class="word">and</span>
                    <span class="word background">whole,</span>
                </span>
                <span class="word-group">
                    <span class="word">both</span>
                    <span class="word gradient-text">finite</span>
                </span>
                <span class="word-group">
                    <span class="word">and</span>
                    <span class="word gradient-text">infinite.</span>
                </span>
            </p>
            
            <div id="translation-tooltip" class="translation-tooltip">
                <div id="tooltip-text"></div>
                <div id="tooltip-source" class="translation-origin"></div>
            </div>

            <!-- Semantic neighborhood visualization -->
            <div id="semantic-map" class="semantic-map">
                <div class="semantic-map-inner">
                    <div class="semantic-map-title">Semantic Neighborhood</div>
                    <div class="semantic-map-content">
                        <canvas id="semantic-canvas"></canvas>
                    </div>
                    <div class="semantic-map-footer">
                        <button id="semantic-close">Close</button>
                    </div>
                </div>
            </div>
            
            <div id="tap-feedback" class="tap-feedback"></div>
        </div>
        
        <div class="settings-panel">
            <div class="settings-button" id="settings-toggle" aria-label="Settings" role="button" tabindex="0">
                ⚙️
            </div>
        </div>
        
        <div class="settings-panel-expanded" id="settings-panel">
            <div class="settings-title">Typography Settings</div>
            
            <div class="settings-row">
                <div class="settings-label">Depth Intensity</div>
                <div class="slider-container">
                    <input type="range" min="0" max="100" value="50" class="slider" id="depth-slider" aria-label="Adjust depth intensity">
                </div>
            </div>
            
            <div class="settings-row">
                <div class="settings-label">Parallax Sensitivity</div>
                <div class="slider-container">
                    <input type="range" min="0" max="100" value="50" class="slider" id="parallax-slider" aria-label="Adjust parallax sensitivity">
                </div>
            </div>
            
            <div class="settings-row">
                <div class="settings-label">Glow Intensity</div>
                <div class="slider-container">
                    <input type="range" min="0" max="100" value="50" class="slider" id="glow-slider" aria-label="Adjust glow intensity">
                </div>
            </div>
            
            <div class="settings-row">
                <div class="settings-label">Reading Guide</div>
                <label class="toggle-switch">
                    <input type="checkbox" id="reading-cursor-toggle" aria-label="Toggle reading guide">
                    <span class="toggle-slider"></span>
                </label>
            </div>
            
            <div class="settings-row">
                <div class="settings-label">Dark Mode</div>
                <label class="toggle-switch">
                    <input type="checkbox" checked id="dark-mode-toggle" aria-label="Toggle dark mode">
                    <span class="toggle-slider"></span>
                </label>
            </div>
        </div>
    </div>

    <style>
        /* Semantic neighborhood visualization */
        .semantic-map {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(5, 10, 20, 0.85);
            backdrop-filter: blur(10px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.4s var(--transition-smooth), visibility 0.4s var(--transition-smooth);
        }
        
        .semantic-map.visible {
            opacity: 1;
            visibility: visible;
        }
        
        .semantic-map-inner {
            width: 90%;
            height: 90%;
            max-width: 350px;
            max-height: 600px;
            background: rgba(20, 30, 50, 0.9);
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            border: 1px solid var(--accent-cyan);
            box-shadow: 0 0 30px rgba(100, 200, 255, 0.3);
            overflow: hidden;
        }
        
        .semantic-map-title {
            padding: 1rem;
            text-align: center;
            font-size: 18px;
            font-weight: 500;
            color: var(--text-primary);
            border-bottom: 1px solid rgba(100, 200, 255, 0.2);
            background: rgba(30, 40, 60, 0.8);
        }
        
        .semantic-map-content {
            flex: 1;
            padding: 1rem;
            overflow: hidden;
            position: relative;
        }
        
        .semantic-map-footer {
            padding: 1rem;
            display: flex;
            justify-content: center;
            border-top: 1px solid rgba(100, 200, 255, 0.2);
        }
        
        .semantic-map-footer button {
            background: rgba(100, 200, 255, 0.2);
            border: 1px solid rgba(100, 200, 255, 0.4);
            color: var(--text-primary);
            padding: 0.6rem 2rem;
            border-radius: 30px;
            font-family: 'Menlo', monospace;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .semantic-map-footer button:hover {
            background: rgba(100, 200, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }
        
        /* Multiple word alternatives */
        .word.multi-substitution {
            color: var(--accent-cyan);
            text-shadow: 0 0 8px var(--glow-cyan);
            cursor: pointer;
            position: relative;
            border-bottom: 1px dotted rgba(120, 210, 255, 0.25);
            padding-bottom: 2px;
            transform: translateZ(4px);
            transition: all 0.3s var(--transition-smooth);
        }
        
        .word.multi-substitution:hover, .word.multi-substitution:active {
            color: var(--accent-cyan);
            text-shadow: 0 0 12px var(--glow-cyan);
            border-bottom-color: rgba(120, 210, 255, 0.6);
        }
        
        .semantic-node {
            position: absolute;
            background: rgba(100, 200, 255, 0.1);
            border: 1px solid rgba(100, 200, 255, 0.3);
            color: var(--text-primary);
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 14px;
            transition: all 0.2s ease;
            cursor: pointer;
            text-align: center;
            transform: translate(-50%, -50%);
        }
        
        .semantic-node:hover {
            background: rgba(100, 200, 255, 0.2);
            transform: translate(-50%, -50%) scale(1.1);
            z-index: 10;
        }
        
        .semantic-node.central {
            background: rgba(100, 200, 255, 0.3);
            border: 2px solid rgba(100, 200, 255, 0.6);
            font-weight: bold;
            z-index: 5;
            padding: 8px 16px;
            font-size: 16px;
        }
        
        .semantic-node.selected {
            background: rgba(150, 255, 180, 0.3);
            border: 2px solid rgba(150, 255, 180, 0.6);
            color: var(--accent-mint);
            text-shadow: 0 0 8px var(--glow-mint);
        }
    </style>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Elements
            const textScene = document.getElementById('text-scene');
            const translationTooltip = document.getElementById('translation-tooltip');
            const tooltipText = document.getElementById('tooltip-text');
            const tooltipSource = document.getElementById('tooltip-source');
            const settingsToggle = document.getElementById('settings-toggle');
            const settingsPanel = document.getElementById('settings-panel');
            const readingCursor = document.getElementById('reading-cursor');
            const tapFeedback = document.getElementById('tap-feedback');
            const semanticMap = document.getElementById('semantic-map');
            const semanticCanvas = document.getElementById('semantic-canvas');
            const semanticClose = document.getElementById('semantic-close');
            
            // Variables for tracking state
            let lastX = 0;
            let lastY = 0;
            let isMoving = false;
            let isReadingActive = false;
            let activeTooltipElement = null;
            let currentMultiWord = null;
            
            // Tap timing for triple tap detection
            let tapCount = 0;
            let lastTapTime = 0;
            let tapTimer = null;
            
            // Settings variables
            let depthIntensity = 0.5;
            let parallaxSensitivity = 0.5;
            let glowIntensity = 0.5;
            let isDarkMode = true;
            
            // Initialize sliders and toggles
            const depthSlider = document.getElementById('depth-slider');
            const parallaxSlider = document.getElementById('parallax-slider');
            const glowSlider = document.getElementById('glow-slider');
            const darkModeToggle = document.getElementById('dark-mode-toggle');
            const readingCursorToggle = document.getElementById('reading-cursor-toggle');
            
            // Initialize text depths with subtle variations
            function initializeTextDepths() {
                // Set random z-depths for regular words
                const words = document.querySelectorAll('.word:not(.foreground):not(.background):not(.multi-substitution):not(.gradient-text)');
                words.forEach(word => {
                    // Create more subtle and natural depth variations
                    const zDepth = (Math.random() * 5 - 2.5).toFixed(2);
                    word.style.transform = `translateZ(${zDepth}px)`;
                    
                    // Add subtle glow to some words
                    if (Math.random() > 0.7) {
                        const hue = 190 + Math.random() * 40;
                        const intensity = 0.2 + Math.random() * 0.3;
                        word.style.textShadow = `0 0 5px hsla(${hue}, 80%, 70%, ${intensity})`;
                    }
                });
                
                // Add slight rotations to some words for more organic feel
                document.querySelectorAll('.word').forEach(word => {
                    if (Math.random() > 0.7) {
                        const rotateX = (Math.random() * 2 - 1).toFixed(2);
                        const rotateY = (Math.random() * 2 - 1).toFixed(2);
                        const currentTransform = word.style.transform || '';
                        
                        if (!currentTransform.includes('rotate')) {
                            word.style.transform = `${currentTransform} rotateX(${rotateX}deg) rotateY(${rotateY}deg)`;
                        }
                    }
                });
            }
            
            // Handle multi-substitution words
            function setupMultiSubstitutions() {
                const substitutionWords = document.querySelectorAll('.multi-substitution');
                
                substitutionWords.forEach(word => {
                    let tapCount = 0;
                    let lastTapTime = 0;
                    
                    // Store original word and alternatives
                    const originalWord = word.getAttribute('data-word');
                    const alternatives = word.getAttribute('data-alternatives').split(',');
                    const allWords = [originalWord, ...alternatives];
                    
                    // Set up click handler for word cycling
                    word.addEventListener('click', function(e) {
                        e.preventDefault();
                        showTapFeedback(e.clientX, e.clientY);
                        
                        // Get current displayed text
                        const currentText = word.querySelector('.current-text').textContent;
                        
                        // Find current index in all words
                        const currentIndex = allWords.indexOf(currentText);
                        const nextIndex = (currentIndex + 1) % allWords.length;
                        
                        // Update displayed text
                        word.querySelector('.current-text').textContent = allWords[nextIndex];
                        
                        // Track tap timing for triple tap detection
                        const now = Date.now();
                        if (now - lastTapTime < 500) { // Within 500ms
                            tapCount++;
                            
                            if (tapCount === 3) { // Triple tap detected
                                // Show semantic map
                                showSemanticMap(word, currentText, allWords);
                                tapCount = 0;
                            }
                        } else {
                            tapCount = 1;
                        }
                        
                        lastTapTime = now;
                    });
                    
                    // Keyboard accessibility
                    word.addEventListener('keydown', function(e) {
                        if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            this.click();
                        }
                    });
                });
            }
            
            // Show semantic neighborhood map
            function showSemanticMap(wordElement, currentWord, allWords) {
                // Store current word for returning to the main view
                currentMultiWord = wordElement;
                
                // Set up canvas
                const canvas = semanticCanvas;
                const ctx = canvas.getContext('2d');
                
                // Set canvas dimensions
                canvas.width = semanticMap.querySelector('.semantic-map-content').offsetWidth;
                canvas.height = semanticMap.querySelector('.semantic-map-content').offsetHeight;
                
                // Clear any existing nodes
                const contentDiv = semanticMap.querySelector('.semantic-map-content');
                while (contentDiv.querySelector('.semantic-node')) {
                    contentDiv.removeChild(contentDiv.querySelector('.semantic-node'));
                }
                
                // Create radar/radial map
                createRadarMap(contentDiv, currentWord, allWords);
                
                // Show the semantic map
                semanticMap.classList.add('visible');
            }
            
            // Create radar/radial map of semantic neighbors
            function createRadarMap(container, centralWord, neighbors) {
                // Calculate center and radius
                const centerX = container.offsetWidth / 2;
                const centerY = container.offsetHeight / 2;
                const maxRadius = Math.min(centerX, centerY) * 0.85;
                
                // Create central node
                const centralNode = document.createElement('div');
                centralNode.className = 'semantic-node central';
                centralNode.textContent = centralWord;
                centralNode.style.left = `${centerX}px`;
                centralNode.style.top = `${centerY}px`;
                container.appendChild(centralNode);
                
                // Create neighbor nodes in a circular pattern
                neighbors.forEach((word, index) => {
                    if (word === centralWord) return; // Skip central word
                    
                    // Calculate position on the circle
                    const angle = (index / neighbors.length) * 2 * Math.PI;
                    const distance = 0.4 + Math.random() * 0.5; // Randomize distance between 0.4 and 0.9 of radius
                    const x = centerX + Math.cos(angle) * maxRadius * distance;
                    const y = centerY + Math.sin(angle) * maxRadius * distance;
                    
                    // Create node
                    const node = document.createElement('div');
                    node.className = 'semantic-node';
                    node.textContent = word;
                    node.style.left = `${x}px`;
                    node.style.top = `${y}px`;
                    
                    // Handle node selection
                    node.addEventListener('click', function() {
                        // Update word in the main view
                        if (currentMultiWord) {
                            currentMultiWord.querySelector('.current-text').textContent = word;
                            
                            // Create selection effect
                            document.querySelectorAll('.semantic-node').forEach(n => n.classList.remove('selected'));
                            this.classList.add('selected');
                            
                            // Close after a short delay
                            setTimeout(() => {
                                semanticMap.classList.remove('visible');
                            }, 800);
                        }
                    });
                    
                    container.appendChild(node);
                });
                
                // Draw connecting lines on canvas
                const canvas = semanticCanvas;
                const ctx = canvas.getContext('2d');
                
                // Clear canvas
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Draw connecting lines from central node to others
                const nodes = container.querySelectorAll('.semantic-node:not(.central)');
                ctx.strokeStyle = 'rgba(100, 200, 255, 0.2)';
                ctx.lineWidth = 1;
                
                nodes.forEach(node => {
                    const x = parseFloat(node.style.left);
                    const y = parseFloat(node.style.top);
                    
                    ctx.beginPath();
                    ctx.moveTo(centerX, centerY);
                    ctx.lineTo(x, y);
                    ctx.stroke();
                });
            }
            
            // Close semantic map
            semanticClose.addEventListener('click', function() {
                semanticMap.classList.remove('visible');
            });
            
            // Handle foreign text translations
            function setupTranslations() {
                const foreignTexts = document.querySelectorAll('.foreign-text');
                
                foreignTexts.forEach(text => {
                    const translation = text.getAttribute('data-translation');
                    const source = text.getAttribute('data-source');
                    
                    // Touch handling
                    text.addEventListener('touchstart', function(e) {
                        longPressTimer = setTimeout(function() {
                            showTranslation(text, translation, source);
                            activeTooltipElement = text;
                            
                            // Vibrate if available
                            if (navigator.vibrate) {
                                navigator.vibrate(50);
                            }
                        }, 500); // Show after 500ms hold
                    }, { passive: true });
                    
                    text.addEventListener('touchend', function() {
                        clearTimeout(longPressTimer);
                        
                        // Hide tooltip after a delay if this is the active element
                        if (activeTooltipElement === text) {
                            setTimeout(() => {
                                if (activeTooltipElement === text) {
                                    translationTooltip.classList.remove('visible');
                                    activeTooltipElement = null;
                                }
                            }, 2000);
                        }
                    });
                    
                    // Click for desktop
                    text.addEventListener('click', function(e) {
                        showTapFeedback(e.clientX, e.clientY);
                        showTranslation(text, translation, source);
                        activeTooltipElement = text;
                    });
                    
                    // Keyboard accessibility
                    text.addEventListener('keydown', function(e) {
                        if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            showTranslation(text, translation, source);
                            activeTooltipElement = text;
                        }
                    });
                });
                
                // Hide tooltip when clicking elsewhere
                document.addEventListener('click', function(e) {
                    if (!e.target.closest('.foreign-text') && !e.target.closest('.translation-tooltip')) {
                        translationTooltip.classList.remove('visible');
                        activeTooltipElement = null;
                    }
                });
            }
            
            function showTranslation(element, translation, source) {
                // Calculate position for tooltip
                const rect = element.getBoundingClientRect();
                const containerRect = textScene.getBoundingClientRect();
                
                // Position the tooltip
                if (element.classList.contains('persian')) {
                    // For right-to-left text, position differently
                    translationTooltip.style.top = (rect.top - containerRect.top + rect.height + 15) + 'px';
                    translationTooltip.style.left = Math.max(10, Math.min(containerRect.width - 300, 
                        rect.left - containerRect.left)) + 'px';
                    translationTooltip.style.transformOrigin = '10% 0';
                } else {
                    translationTooltip.style.top = (rect.top - containerRect.top + rect.height + 15) + 'px';
                    translationTooltip.style.left = Math.max(10, Math.min(containerRect.width - 300, 
                        rect.left - containerRect.left - 140 + rect.width / 2)) + 'px';
                    translationTooltip.style.transformOrigin = '50% 0';
                }
                
                // Set content and show
                tooltipText.textContent = translation;
                tooltipSource.textContent = source;
                translationTooltip.classList.add('visible');
            }
            
            // Settings panel toggle
            function setupSettingsPanel() {
                settingsToggle.addEventListener('click', function(e) {
                    showTapFeedback(e.clientX, e.clientY);
                    settingsPanel.classList.toggle('visible');
                });
                
                // Close when clicking outside
                document.addEventListener('click', function(e) {
                    if (settingsPanel.classList.contains('visible') && 
                        !e.target.closest('.settings-panel') && 
                        !e.target.closest('.settings-button')) {
                        settingsPanel.classList.remove('visible');
                    }
                });
                
                // Keyboard accessibility
                settingsToggle.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        this.click();
                    }
                });
            }
            
            // Update settings from sliders
            function setupSettingsControls() {
                depthSlider.addEventListener('input', function() {
                    depthIntensity = this.value / 100;
                    updateDepthIntensity();
                });
                
                parallaxSlider.addEventListener('input', function() {
                    parallaxSensitivity = this.value / 100;
                });
                
                glowSlider.addEventListener('input', function() {
                    glowIntensity = this.value / 100;
                    updateGlowIntensity();
                });
                
                darkModeToggle.addEventListener('change', function() {
                    isDarkMode = this.checked;
                    updateColorScheme();
                });
                
                readingCursorToggle.addEventListener('change', function() {
                    isReadingActive = this.checked;
                    if (isReadingActive) {
                        readingCursor.classList.remove('hidden');
                    } else {
                        readingCursor.classList.add('hidden');
                    }
                });
            }
            
            function updateDepthIntensity() {
                // Calculate depths based on intensity
                const foregroundDepth = 4 + (depthIntensity * 10);
                const backgroundDepth = -4 - (depthIntensity * 10);
                
                // Update CSS custom properties
                document.documentElement.style.setProperty('--depth-foreground', `${foregroundDepth}px`);
                document.documentElement.style.setProperty('--depth-background', `${backgroundDepth}px`);
                
                // Apply to existing elements with specific classes
                document.querySelectorAll('.foreground').forEach(word => {
                    const currentTransform = word.style.transform || '';
                    word.style.transform = currentTransform.replace(/translateZ\([^)]*\)/, `translateZ(${foregroundDepth}px)`);
                });
                
                document.querySelectorAll('.background').forEach(word => {
                    const currentTransform = word.style.transform || '';
                    word.style.transform = currentTransform.replace(/translateZ\([^)]*\)/, `translateZ(${backgroundDepth}px)`);
                });
                
                // Update floating animation
                document.querySelectorAll('.floating').forEach(word => {
                    word.style.animationName = 'none';
                    setTimeout(() => {
                        word.style.animationName = 'float';
                    }, 10);
                });
            }
            
            function updateGlowIntensity() {
                // Calculate glow amounts based on intensity
                const foregroundGlow = 3 + (glowIntensity * 15);
                const glowColor = `rgba(100, 200, 255, ${glowIntensity * 0.5 + 0.2})`;
                
                // Update CSS custom properties
                document.documentElement.style.setProperty('--glow-cyan', glowColor);
                
                // Apply to specific elements
                document.querySelectorAll('.pulse-glow').forEach(word => {
                    word.style.animationName = 'none';
                    setTimeout(() => {
                        word.style.animationName = 'pulse';
                    }, 10);
                });
                
                document.querySelectorAll('.foreground:not(.pulse-glow)').forEach(word => {
                    word.style.textShadow = `0 0 ${foregroundGlow}px ${glowColor}`;
                });
                
                // Update other glow elements
                document.querySelectorAll('.multi-substitution').forEach(word => {
                    word.style.textShadow = `0 0 ${glowIntensity * 8 + 2}px ${glowColor}`;
                });
            }
            
            function updateColorScheme() {
                const container = document.querySelector('.iphone-container');
                
                if (isDarkMode) {
                    // Dark mode colors
                    document.documentElement.style.setProperty('--bg-primary', '#0a0a12');
                    document.documentElement.style.setProperty('--bg-secondary', '#12121e');
                    document.documentElement.style.setProperty('--bg-tertiary', '#1a1a2e');
                    document.documentElement.style.setProperty('--text-primary', 'rgba(230, 230, 240, 0.94)');
                    document.documentElement.style.setProperty('--text-secondary', 'rgba(200, 200, 220, 0.85)');
                    document.documentElement.style.setProperty('--text-tertiary', 'rgba(170, 170, 190, 0.75)');
                    
                    container.style.background = 'linear-gradient(135deg, var(--bg-primary), var(--bg-tertiary))';
                } else {
                    // Light mode colors
                    document.documentElement.style.setProperty('--bg-primary', '#f0f0f8');
                    document.documentElement.style.setProperty('--bg-secondary', '#e8e8f0');
                    document.documentElement.style.setProperty('--bg-tertiary', '#e0e0ee');
                    document.documentElement.style.setProperty('--text-primary', 'rgba(40, 40, 60, 0.94)');
                    document.documentElement.style.setProperty('--text-secondary', 'rgba(60, 60, 80, 0.85)');
                    document.documentElement.style.setProperty('--text-tertiary', 'rgba(80, 80, 100, 0.75)');
                    
                    container.style.background = 'linear-gradient(135deg, var(--bg-primary), var(--bg-tertiary))';
                }
                
                // Update all word colors that aren't special classes
                document.querySelectorAll('.word:not(.foreground):not(.background):not(.gradient-text):not(.multi-substitution)').forEach(word => {
                    word.style.color = 'var(--text-primary)';
                });
                
                document.querySelectorAll('.background').forEach(word => {
                    word.style.color = 'var(--text-tertiary)';
                });
            }
            
            // Reading cursor functionality
            function updateReadingCursor(x, y) {
                if (!isReadingActive) return;
                
                // Find the word closest to the cursor
                const words = document.querySelectorAll('.word, .foreign-text');
                let closestWord = null;
                let closestDistance = Infinity;
                
                words.forEach(word => {
                    const rect = word.getBoundingClientRect();
                    const wordX = rect.left + rect.width / 2;
                    const wordY = rect.top + rect.height / 2;
                    
                    const distance = Math.sqrt(
                        Math.pow(wordX - x, 2) + 
                        Math.pow(wordY - y, 2)
                    );
                    
                    if (distance < closestDistance) {
                        closestDistance = distance;
                        closestWord = word;
                    }
                });
                
                if (closestWord && closestDistance < 150) {
                    const rect = closestWord.getBoundingClientRect();
                    const containerRect = textScene.getBoundingClientRect();
                    
                    readingCursor.style.left = (rect.left - containerRect.left - 5) + 'px';
                    readingCursor.style.top = (rect.top - containerRect.top) + 'px';
                    readingCursor.style.height = rect.height + 'px';
                    readingCursor.classList.remove('hidden');
                } else {
                    readingCursor.classList.add('hidden');
                }
            }
            
            // Show tap feedback effect
            function showTapFeedback(x, y) {
                // Position the feedback element
                tapFeedback.style.left = x + 'px';
                tapFeedback.style.top = y + 'px';
                
                // Trigger animation
                tapFeedback.style.animation = 'none';
                setTimeout(() => {
                    tapFeedback.style.animation = 'tap-ripple 0.6s forwards';
                }, 10);
            }
            
            // Parallax effect on mouse/touch move
            function handleMovement(clientX, clientY) {
                if (!isMoving) {
                    requestAnimationFrame(() => {
                        const containerRect = textScene.getBoundingClientRect();
                        
                        // Calculate mouse position relative to container center
                        const centerX = containerRect.left + containerRect.width / 2;
                        const centerY = containerRect.top + containerRect.height / 2;
                        
                        const deltaX = (clientX - centerX) / (containerRect.width / 2);
                        const deltaY = (clientY - centerY) / (containerRect.height / 2);
                        
                        // Apply parallax to text scene based on sensitivity
                        const rotateAmount = parallaxSensitivity * 10;
                        const moveAmount = parallaxSensitivity * 15;
                        
                        textScene.style.transform = `
                            perspective(1200px)
                            rotateY(${deltaX * rotateAmount}deg) 
                            rotateX(${-deltaY * rotateAmount}deg)
                            translateX(${deltaX * moveAmount * 0.4}px)
                            translateY(${deltaY * moveAmount * 0.4}px)
                        `;
                        
                        // Apply parallax to individual words based on their z-depth
                        document.querySelectorAll('.word, .foreign-text').forEach(word => {
                            let zDepth = 0;
                            
                            // Extract z-depth from transform if it exists
                            const transformStyle = word.style.transform || '';
                            const zMatch = transformStyle.match(/translateZ\(([^)]+)\)/);
                            if (zMatch) {
                                zDepth = parseFloat(zMatch[1]);
                            } else if (word.classList.contains('foreground')) {
                                zDepth = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--depth-foreground'));
                            } else if (word.classList.contains('background')) {
                                zDepth = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--depth-background'));
                            }
                            
                            // Scale movement based on depth and sensitivity
                            const depthFactor = Math.abs(zDepth) * 0.2 * parallaxSensitivity;
                            const moveX = deltaX * depthFactor * moveAmount;
                            const moveY = deltaY * depthFactor * moveAmount;
                            
                            // Update transform preserving existing properties
                            let newTransform = transformStyle.replace(/translate(X|Y)\([^)]*\)/g, '');
                            newTransform += ` translateX(${moveX}px) translateY(${moveY}px)`;
                            word.style.transform = newTransform;
                        });
                        
                        // Update reading cursor
                        updateReadingCursor(clientX, clientY);
                        
                        lastX = clientX;
                        lastY = clientY;
                        isMoving = false;
                    });
                    
                    isMoving = true;
                }
            }
            
            // Set up event listeners
            function setupEventListeners() {
                // Mouse movement handler
                document.addEventListener('mousemove', function(e) {
                    handleMovement(e.clientX, e.clientY);
                });
                
                // Touch movement handler with passive option for better performance
                document.addEventListener('touchmove', function(e) {
                    handleMovement(e.touches[0].clientX, e.touches[0].clientY);
                }, { passive: true });
                
                // Reset position when mouse leaves or touch ends
                document.addEventListener('mouseleave', resetPosition);
                document.addEventListener('touchend', resetPosition);
                
                // Add subtle movement on scroll for mobile
                window.addEventListener('deviceorientation', function(e) {
                    if (e.beta && e.gamma) {
                        const x = window.innerWidth / 2 + (e.gamma * 10);
                        const y = window.innerHeight / 2 + (e.beta * 10);
                        handleMovement(x, y);
                    }
                }, true);
                
                // Hide semantic map when clicking outside
                semanticMap.addEventListener('click', function(e) {
                    if (e.target === semanticMap) {
                        semanticMap.classList.remove('visible');
                    }
                });
            }
            
            function resetPosition() {
                // Smoothly reset the scene position
                textScene.style.transform = 'perspective(1200px) rotateY(0deg) rotateX(0deg) translateX(0) translateY(0)';
                
                // Reset word positions
                document.querySelectorAll('.word, .foreign-text').forEach(word => {
                    const transform = word.style.transform || '';
                    word.style.transform = transform.replace(/translate(X|Y)\([^)]*\)/g, '');
                });
                
                // Hide reading cursor
                readingCursor.classList.add('hidden');
            }
            
            // Initialize the experience
            function initialize() {
                initializeTextDepths();
                setupMultiSubstitutions();
                setupTranslations();
                setupSettingsPanel();
                setupSettingsControls();
                setupEventListeners();
                
                // Apply initial settings
                updateDepthIntensity();
                updateGlowIntensity();
                updateColorScheme();
            }
            
            // Start the application
            initialize();
        });
    </script>
</body>
</html>data-translation');
                    const source = text.getAttribute('<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dimensional Typography</title>
    <style>
        @font-face {
            font-family: 'Menlo';
            src: local('Menlo'), local('Menlo Regular');
            font-weight: normal;
            font-style: normal;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        :root {
            --text-primary: rgba(230, 230, 240, 0.94);
            --text-secondary: rgba(200, 200, 220, 0.85);
            --text-tertiary: rgba(170, 170, 190, 0.75);
            --accent-cyan: rgba(120, 210, 255, 0.9);
            --accent-mint: rgba(150, 255, 180, 0.9);
            --accent-gold: rgba(255, 200, 120, 0.9);
            --accent-magenta: rgba(255, 150, 220, 0.9);
            --glow-cyan: rgba(100, 200, 255, 0.4);
            --glow-mint: rgba(100, 255, 180, 0.4);
            --glow-gold: rgba(255, 200, 100, 0.4);
            --glow-magenta: rgba(255, 150, 220, 0.4);
            --bg-primary: #0a0a12;
            --bg-secondary: #12121e;
            --bg-tertiary: #1a1a2e;
            --depth-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            --depth-foreground: 8px;
            --depth-background: -8px;
            --transition-smooth: cubic-bezier(0.22, 1, 0.36, 1);
        }
        
        body {
            background-color: #000;
            color: var(--text-primary);
            font-family: 'Menlo', monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            height: 100vh;
            touch-action: manipulation;
        }
        
        .iphone-container {
            position: relative;
            width: 390px; /* iPhone 12/13/14 width */
            height: 844px; /* iPhone 12/13/14 height */
            overflow: hidden;
            background: linear-gradient(135deg, var(--bg-primary), var(--bg-tertiary));
            perspective: 1200px;
            perspective-origin: 50% 50%;
            border-radius: 40px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5),
                        0 10px 20px -5px rgba(0, 0, 0, 0.2),
                        inset 0 0 2px rgba(255, 255, 255, 0.05);
        }
        
        .text-scene {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            padding: 2.5rem 1.75rem;
            overflow: hidden;
            transition: transform 0.3s var(--transition-smooth);
        }
        
        .paragraph {
            position: relative;
            font-size: 17px;
            line-height: 1.7;
            transform-style: preserve-3d;
            margin-bottom: 1.8rem;
            letter-spacing: -0.01em;
            color: var(--text-primary);
            font-kerning: normal;
            text-rendering: optimizeLegibility;
            -webkit-font-smoothing: antialiased;
            width: calc(100% - 10px);
        }
        
        .word {
            display: inline-block;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.7s var(--transition-smooth),
                        text-shadow 0.7s var(--transition-smooth),
                        color 0.7s var(--transition-smooth);
            margin-right: 0.25em;
            white-space: nowrap;
            will-change: transform, text-shadow;
        }
        
        .foreground {
            transform: translateZ(var(--depth-foreground));
            color: var(--text-primary);
            text-shadow: 0 0 8px var(--glow-cyan);
            font-weight: 500;
        }
        
        .background {
            transform: translateZ(var(--depth-background));
            color: var(--text-tertiary);
            text-shadow: 0 0 0 transparent;
            font-weight: 300;
        }
        
        .original-text, .alternative-text {
            transition: opacity 0.4s var(--transition-smooth),
                        transform 0.4s var(--transition-smooth);
        }
        
        .alternative-text {
            position: absolute;
            top: 0;
            left: 0;
            opacity: 0;
            pointer-events: none;
            transform: translateY(5px);
        }
        
        .word.substitution {
            color: var(--accent-cyan);
            text-shadow: 0 0 8px var(--glow-cyan);
            cursor: pointer;
            position: relative;
            border-bottom: 1px dotted rgba(120, 210, 255, 0.25);
            padding-bottom: 2px;
            transform: translateZ(4px);
            transition: all 0.3s var(--transition-smooth);
        }
        
        .word.substitution:hover, .word.substitution:active {
            color: var(--accent-cyan);
            text-shadow: 0 0 12px var(--glow-cyan);
            border-bottom-color: rgba(120, 210, 255, 0.6);
        }
        
        .foreign-text {
            position: relative;
            cursor: pointer;
            display: inline-block;
            line-height: 1.4;
            margin: 0.1em 0.4em;
            padding: 0.2em 0.4em;
            border-radius: 0.35em;
            transition: all 0.3s var(--transition-smooth);
            transform: translateZ(4px);
            transform-style: preserve-3d;
        }
        
        .foreign-text::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(30, 40, 60, 0.15);
            border-radius: 0.35em;
            z-index: -1;
            transition: all 0.3s var(--transition-smooth);
            transform: translateZ(-2px);
        }
        
        .foreign-text:hover::before, .foreign-text:active::before {
            background: rgba(40, 50, 80, 0.25);
        }
        
        .foreign-text.persian {
            font-family: 'Tahoma', sans-serif;
            color: var(--accent-gold);
            text-shadow: 0 0 8px var(--glow-gold);
            direction: rtl;
            font-size: 0.9em;
            padding: 0.25em 0.5em;
            line-height: 1.7;
        }
        
        .foreign-text.chinese {
            font-family: 'PingFang SC', 'SimSun', 'STSong', sans-serif;
            color: var(--accent-mint);
            text-shadow: 0 0 8px var(--glow-mint);
            font-size: 1.1em;
            font-weight: 400;
            letter-spacing: 0.05em;
        }
        
        .centered-poetry {
            text-align: center;
            margin: 2rem 0;
            transform-style: preserve-3d;
            transform: translateZ(6px);
        }
        
        .poetry-line {
            margin-bottom: 0.8rem;
            transform-style: preserve-3d;
            position: relative;
        }
        
        .translation-tooltip {
            position: absolute;
            background: rgba(15, 20, 35, 0.96);
            backdrop-filter: blur(10px);
            padding: 1rem;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3),
                        0 0 15px var(--glow-cyan),
                        inset 0 0 1px rgba(200, 220, 255, 0.2);
            font-size: 15px;
            line-height: 1.5;
            width: max-content;
            max-width: 300px;
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s var(--transition-smooth);
            transform: translateY(5px) scale(0.98);
            pointer-events: none;
            border: 1px solid rgba(100, 200, 255, 0.15);
            color: var(--text-primary);
        }
        
        .translation-tooltip.visible {
            opacity: 1;
            visibility: visible;
            transform: translateY(0) scale(1);
        }
        
        .translation-tooltip::after {
            content: '';
            position: absolute;
            top: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-bottom: 8px solid rgba(15, 20, 35, 0.9);
        }
        
        .translation-origin {
            font-size: 0.8em;
            margin-top: 0.5em;
            opacity: 0.7;
            font-style: italic;
        }
        
        .settings-panel {
            position: absolute;
            bottom: 2rem;
            right: 2rem;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            z-index: 100;
        }
        
        .settings-button {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(30, 40, 60, 0.8);
            backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-primary);
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2),
                        0 0 8px var(--glow-cyan);
            transition: all 0.3s var(--transition-smooth);
            border: 1px solid rgba(100, 200, 255, 0.15);
            font-size: 20px;
            will-change: transform, box-shadow;
        }
        
        .settings-button:hover, .settings-button:active {
            background: rgba(40, 60, 80, 0.9);
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3),
                        0 0 12px var(--glow-cyan);
        }
        
        .settings-panel-expanded {
            position: absolute;
            bottom: 5rem;
            right: 2rem;
            background: rgba(15, 20, 35, 0.95);
            backdrop-filter: blur(10px);
            padding: 1.5rem;
            border-radius: 16px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3),
                        0 0 20px var(--glow-cyan),
                        inset 0 0 2px rgba(200, 220, 255, 0.2);
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transform: translateY(20px) scale(0.95);
            transition: all 0.4s var(--transition-smooth);
            border: 1px solid rgba(100, 200, 255, 0.15);
            width: 300px;
        }
        
        .settings-panel-expanded.visible {
            opacity: 1;
            visibility: visible;
            transform: translateY(0) scale(1);
        }
        
        .settings-title {
            margin-bottom: 1.25rem;
            font-size: 17px;
            font-weight: bold;
            color: var(--text-primary);
            position: relative;
            padding-bottom: 0.5rem;
        }
        
        .settings-title::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 1px;
            background: linear-gradient(90deg, 
                var(--accent-cyan), 
                rgba(120, 210, 255, 0.2), 
                transparent);
        }
        
        .settings-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.25rem;
        }
        
        .settings-label {
            color: var(--text-secondary);
            font-size: 15px;
        }
        
        .slider-container {
            width: 120px;
            height: 20px;
            position: relative;
        }
        
        .slider {
            -webkit-appearance: none;
            width: 100%;
            height: 4px;
            border-radius: 2px;
            background: rgba(100, 200, 255, 0.2);
            outline: none;
            transition: all 0.2s ease;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--accent-cyan);
            cursor: pointer;
            box-shadow: 0 0 10px var(--glow-cyan);
            transition: all 0.2s ease;
        }
        
        .slider::-moz-range-thumb {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--accent-cyan);
            cursor: pointer;
            box-shadow: 0 0 10px var(--glow-cyan);
            border: none;
            transition: all 0.2s ease;
        }
        
        .slider::-webkit-slider-thumb:hover {
            transform: scale(1.1);
            box-shadow: 0 0 15px var(--glow-cyan);
        }
        
        .slider::-moz-range-thumb:hover {
            transform: scale(1.1);
            box-shadow: 0 0 15px var(--glow-cyan);
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 52px;
            height: 26px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(100, 200, 255, 0.2);
            transition: .4s var(--transition-smooth);
            border-radius: 26px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: #fff;
            transition: .4s var(--transition-smooth);
            border-radius: 50%;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
        }
        
        input:checked + .toggle-slider {
            background-color: var(--accent-cyan);
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }
        
        input:focus + .toggle-slider {
            box-shadow: 0 0 5px var(--glow-cyan);
        }
        
        @keyframes pulse {
            0% {
                text-shadow: 0 0 8px var(--glow-cyan);
            }
            50% {
                text-shadow: 0 0 15px var(--glow-cyan);
            }
            100% {
                text-shadow: 0 0 8px var(--glow-cyan);
            }
        }
        
        @keyframes float {
            0%, 100% {
                transform: translateZ(var(--depth-foreground)) translateY(0);
            }
            50% {
                transform: translateZ(var(--depth-foreground)) translateY(-3px);
            }
        }
        
        .floating {
            animation: float 8s infinite ease-in-out;
        }
        
        .pulse-glow {
            animation: pulse 6s infinite ease-in-out;
        }
        
        .gradient-text {
            background: linear-gradient(90deg, var(--accent-cyan), var(--accent-magenta));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            color: transparent;
            transform: translateZ(2px);
        }
        
        /* Reading cursor */
        .reading-cursor {
            position: absolute;
            width: 2px;
            height: 24px;
            background: var(--accent-cyan);
            border-radius: 1px;
            opacity: 0.7;
            pointer-events: none;
            mix-blend-mode: screen;
            box-shadow: 0 0 8px var(--glow-cyan);
            z-index: 5;
            transform: translateZ(10px);
            transition: opacity 0.3s ease, transform 0.2s ease;
        }
        
        .reading-cursor.hidden {
            opacity: 0;
        }
        
        /* Tap feedback */
        .tap-feedback {
            position: absolute;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: radial-gradient(circle, var(--glow-cyan), transparent 70%);
            opacity: 0;
            pointer-events: none;
            z-index: 10;
            transform: translate(-50%, -50%);
            mix-blend-mode: screen;
        }
        
        @keyframes tap-ripple {
            0% {
                transform: translate(-50%, -50%) scale(0.5);
                opacity: 0.8;
            }
            100% {
                transform: translate(-50%, -50%) scale(2);
                opacity: 0;
            }
        }
        
        /* Fine typography adjustments */
        .word-group {
            display: inline-block;
            margin-right: 0.1em;
            white-space: nowrap;
        }
        
        .tight-space {
            margin-right: 0.05em;
        }
        
        .no-break {
            white-space: nowrap;
        }
        
        /* Refined visual markers */
        .subtitle-line {
            font-size: 0.85em;
            color: var(--text-tertiary);
            margin-bottom: 1.4rem;
            margin-top: -1rem;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            transform: translateZ(2px);
        }
        
        /* Accessibility focus states */
        .word:focus-visible, .foreign-text:focus-visible {
            outline: 2px solid var(--accent-cyan);
            outline-offset: 2px;
            border-radius: 4px;
        }
        
        /* Typography refinements for smaller screens */
        @media (max-width: 390px) {
            .paragraph {
                font-size: 16px;
                line-height: 1.6;
                margin-bottom: 1.6rem;
            }
            
            .foreign-text {
                font-size: 0.9em;
                padding: 0.15em 0.3em;
            }
            
            .settings-panel-expanded {
                width: 280px;
                right: 1rem;
            }
        }
    </style>
</head>;
            --depth-background: -8px;
            --transition-smooth: cubic-bezier(0.22, 1, 0.36, 1);
        }
        
        body {
            background-color: #000;
            color: var(--text-primary);
            font-family: 'Menlo', monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            height: 100vh;
            touch-action: manipulation;
        }
        
        .iphone-container {
            position: relative;
            width: 390px; /* iPhone 12/13/14 width */
            height: 844px; /* iPhone 12/13/14 height */
            overflow: hidden;
            background: linear-gradient(135deg, var(--bg-primary), var(--bg-tertiary));
            perspective: 1200px;
            perspective-origin: 50% 50%;
            border-radius: 40px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5),
                        0 10px 20px -5px rgba(0, 0, 0, 0.2),
                        inset 0 0 2px rgba(255, 255, 255, 0.05);
        }
        
        .text-scene {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            padding: 2.5rem 1.75rem;
            overflow: hidden;
            transition: transform 0.3s var(--transition-smooth);
        }
        
        .paragraph {
            position: relative;
            font-size: 17px;
            line-height: 1.7;
            transform-style: preserve-3d;
            margin-bottom: 1.8rem;
            letter-spacing: -0.01em;
            color: var(--text-primary);
            font-kerning: normal;
            text-rendering: optimizeLegibility;
            -webkit-font-smoothing: antialiased;
            width: calc(100% - 10px);
        }
        
        .word {
            display: inline-block;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.7s var(--transition-smooth),
                        text-shadow 0.7s var(--transition-smooth),
                        color 0.7s var(--transition-smooth);
            margin-right: 0.25em;
            white-space: nowrap;
            will-change: transform, text-shadow;
        }
        
        .foreground {
            transform: translateZ(var(--depth-foreground));
            color: var(--text-primary);
            text-shadow: 0 0 8px var(--glow-cyan);
            font-weight: 500;
        }
        
        .background {
            transform: translateZ(var(--depth-background));
            color: var(--text-tertiary);
            text-shadow: 0 0 0 transparent;
            font-weight: 300;
        }
        
        .original-text, .alternative-text {
            transition: opacity 0.4s var(--transition-smooth),
                        transform 0.4s var(--transition-smooth);
        }
        
        .alternative-text {
            position: absolute;
            top: 0;
            left: 0;
            opacity: 0;
            pointer-events: none;
            transform: translateY(5px);
        }
        
        .word.substitution {
            color: var(--accent-cyan);
            text-shadow: 0 0 8px var(--glow-cyan);
            cursor: pointer;
            position: relative;
            border-bottom: 1px dotted rgba(120, 210, 255, 0.25);
            padding-bottom: 2px;
            transform: translateZ(4px);
            transition: all 0.3s var(--transition-smooth);
        }
        
        .word.substitution:hover, .word.substitution:active {
            color: var(--accent-cyan);
            text-shadow: 0 0 12px var(--glow-cyan);
            border-bottom-color: rgba(120, 210, 255, 0.6);
        }
        
        .foreign-text {
            position: relative;
            cursor: pointer;
            display: inline-block;
            line-height: 1.4;
            margin: 0.1em 0.4em;
            padding: 0.2em 0.4em;
            border-radius: 0.35em;
            transition: all 0.3s var(--transition-smooth);
            transform: translateZ(4px);
            transform-style: preserve-3d;
        }
        
        .foreign-text::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(30, 40, 60, 0.15);
            border-radius: 0.35em;
            z-index: -1;
            transition: all 0.3s var(--transition-smooth);
            transform: translateZ(-2px);
        }
        
        .foreign-text:hover::before, .foreign-text:active::before {
            background: rgba(40, 50, 80, 0.25);
        }
        
        .foreign-text.persian {
            font-family: 'Tahoma', sans-serif;
            color: var(--accent-gold);
            text-shadow: 0 0 8px var(--glow-gold);
            direction: rtl;
            font-size: 0.9em;
            padding: 0.25em 0.5em;
            line-height: 1.7;
        }
        
        .foreign-text.chinese {
            font-family: 'PingFang SC', 'SimSun', 'STSong', sans-serif;
            color: var(--accent-mint);
            text-shadow: 0 0 8px var(--glow-mint);
            font-size: 1.1em;
            font-weight: 400;
            letter-spacing: 0.05em;
        }
        
        .centered-poetry {
            text-align: center;
            margin: 2rem 0;
            transform-style: preserve-3d;
            transform: translateZ(6px);
        }
        
        .poetry-line {
            margin-bottom: 0.8rem;
            transform-style: preserve-3d;
            position: relative;
        }
        
        .translation-tooltip {
            position: absolute;
            background: rgba(15, 20, 35, 0.96);
            backdrop-filter: blur(10px);
            padding: 1rem;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3),
                        0 0 15px var(--glow-cyan),
                        inset 0 0 1px rgba(200, 220, 255, 0.2);
            font-size: 15px;
            line-height: 1.5;
            width: max-content;
            max-width: 300px;
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s var(--transition-smooth);
            transform: translateY(5px) scale(0.98);
            pointer-events: none;
            border: 1px solid rgba(100, 200, 255, 0.15);
            color: var(--text-primary);
        }
        
        .translation-tooltip.visible {
            opacity: 1;
            visibility: visible;
            transform: translateY(0) scale(1);
        }
        
        .translation-tooltip::after {
            content: '';
            position: absolute;
            top: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-bottom: 8px solid rgba(15, 20, 35, 0.9);
        }
        
        .translation-origin {
            font-size: 0.8em;
            margin-top: 0.5em;
            opacity: 0.7;
            font-style: italic;
        }
        
        .settings-panel {
            position: absolute;
            bottom: 2rem;
            right: 2rem;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            z-index: 100;
        }
        
        .settings-button {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(30, 40, 60, 0.8);
            backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-primary);
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2),
                        0 0 8px var(--glow-cyan);
            transition: all 0.3s var(--transition-smooth);
            border: 1px solid rgba(100, 200, 255, 0.15);
            font-size: 20px;
            will-change: transform, box-shadow;
        }
        
        .settings-button:hover, .settings-button:active {
            background: rgba(40, 60, 80, 0.9);
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3),
                        0 0 12px var(--glow-cyan);
        }
        
        .settings-panel-expanded {
            position: absolute;
            bottom: 5rem;
            right: 2rem;
            background: rgba(15, 20, 35, 0.95);
            backdrop-filter: blur(10px);
            padding: 1.5rem;
            border-radius: 16px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3),
                        0 0 20px var(--glow-cyan),
                        inset 0 0 2px rgba(200, 220, 255, 0.2);
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transform: translateY(20px) scale(0.95);
            transition: all 0.4s var(--transition-smooth);
            border: 1px solid rgba(100, 200, 255, 0.15);
            width: 300px;
        }
        
        .settings-panel-expanded.visible {
            opacity: 1;
            visibility: visible;
            transform: translateY(0) scale(1);
        }
        
        .settings-title {
            margin-bottom: 1.25rem;
            font-size: 17px;
            font-weight: bold;
            color: var(--text-primary);
            position: relative;
            padding-bottom: 0.5rem;
        }
        
        .settings-title::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 1px;
            background: linear-gradient(90deg, 
                var(--accent-cyan), 
                rgba(120, 210, 255, 0.2), 
                transparent);
        }
        
        .settings-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.25rem;
        }
        
        .settings-label {
            color: var(--text-secondary);
            font-size: 15px;
        }
        
        .slider-container {
            width: 120px;
            height: 20px;
            position: relative;
        }
        
        .slider {
            -webkit-appearance: none;
            width: 100%;
            height: 4px;
            border-radius: 2px;
            background: rgba(100, 200, 255, 0.2);
            outline: none;
            transition: all 0.2s ease;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--accent-cyan);
            cursor: pointer;
            box-shadow: 0 0 10px var(--glow-cyan);
            transition: all 0.2s ease;
        }
        
        .slider::-moz-range-thumb {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--accent-cyan);
            cursor: pointer;
            box-shadow: 0 0 10px var(--glow-cyan);
            border: none;
            transition: all 0.2s ease;
        }
        
        .slider::-webkit-slider-thumb:hover {
            transform: scale(1.1);
            box-shadow: 0 0 15px var(--glow-cyan);
        }
        
        .slider::-moz-range-thumb:hover {
            transform: scale(1.1);
            box-shadow: 0 0 15px var(--glow-cyan);
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 52px;
            height: 26px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(100, 200, 255, 0.2);
            transition: .4s var(--transition-smooth);
            border-radius: 26px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: #fff;
            transition: .4s var(--transition-smooth);
            border-radius: 50%;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
        }
        
        input:checked + .toggle-slider {
            background-color: var(--accent-cyan);
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }
        
        input:focus + .toggle-slider {
            box-shadow: 0 0 5px var(--glow-cyan);
        }
        
        @keyframes pulse {
            0% {
                text-shadow: 0 0 8px var(--glow-cyan);
            }
            50% {
                text-shadow: 0 0 15px var(--glow-cyan);
            }
            100% {
                text-shadow: 0 0 8px var(--glow-cyan);
            }
        }
        
        @keyframes float {
            0%, 100% {
                transform: translateZ(var(--depth-foreground)) translateY(0);
            }
            50% {
                transform: translateZ(var(--depth-foreground)) translateY(-3px);
            }
        }
        
        .floating {
            animation: float 8s infinite ease-in-out;
        }
        
        .pulse-glow {
            animation: pulse 6s infinite ease-in-out;
        }
        
        .gradient-text {
            background: linear-gradient(90deg, var(--accent-cyan), var(--accent-magenta));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            color: transparent;
            transform: translateZ(2px);
        }
        
        /* Reading cursor */
        .reading-cursor {
            position: absolute;
            width: 2px;
            height: 24px;
            background: var(--accent-cyan);
            border-radius: 1px;
            opacity: 0.7;
            pointer-events: none;
            mix-blend-mode: screen;
            box-shadow: 0 0 8px var(--glow-cyan);
            z-index: 5;
            transform: translateZ(10px);
            transition: opacity 0.3s ease, transform 0.2s ease;
        }
        
        .reading-cursor.hidden {
            opacity: 0;
        }
        
        /* Tap feedback */
        .tap-feedback {
            position: absolute;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: radial-gradient(circle, var(--glow-cyan), transparent 70%);
            opacity: 0;
            pointer-events: none;
            z-index: 10;
            transform: translate(-50%, -50%);
            mix-blend-mode: screen;
        }
        
        @keyframes tap-ripple {
            0% {
                transform: translate(-50%, -50%) scale(0.5);
                opacity: 0.8;
            }
            100% {
                transform: translate(-50%, -50%) scale(2);
                opacity: 0;
            }
        }
        
        /* Fine typography adjustments */
        .word-group {
            display: inline-block;
            margin-right: 0.1em;
            white-space: nowrap;
        }
        
        .tight-space {
            margin-right: 0.05em;
        }
        
        .no-break {
            white-space: nowrap;
        }
        
        /* Refined visual markers */
        .subtitle-line {
            font-size: 0.85em;
            color: var(--text-tertiary);
            margin-bottom: 1.4rem;
            margin-top: -1rem;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            transform: translateZ(2px);
        }
        
        /* Accessibility focus states */
        .word:focus-visible, .foreign-text:focus-visible {
            outline: 2px solid var(--accent-cyan);
            outline-offset: 2px;
            border-radius: 4px;
        }
        
        /* Loading animation */
        .loading-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-primary);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            transition: opacity 1.5s ease-out;
        }
        
        .loading-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .loading-icon {
            width: 100px;
            height: 20px;
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .loading-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--accent-cyan);
            animation: loading-bounce 1.4s infinite ease-in-out both;
        }
        
        .loading-dot:nth-child(1) { 
            animation-delay: -0.32s; 
        }
        
        .loading-dot:nth-child(2) { 
            animation-delay: -0.16s; 
        }
        
        .loading-time {
            font-size: 14px;
            color: var(--text-secondary);
            opacity: 0.8;
        }
        
        @keyframes loading-bounce {
            0%, 80%, 100% { 
                transform: scale(0);
            }
            40% { 
                transform: scale(1.0);
            }
        }
        
        /* Typography refinements for smaller screens */
        @media (max-width: 390px) {
            .paragraph {
                font-size: 16px;
                line-height: 1.6;
                margin-bottom: 1.6rem;
            }
            
            .foreign-text {
                font-size: 0.9em;
                padding: 0.15em 0.3em;
            }
            
            .settings-panel-expanded {
                width: 280px;
                right: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="iphone-container">
        <div class="loading-screen" id="loading-screen">
            <div class="loading-icon">
                <div class="loading-dot"></div>
                <div class="loading-dot"></div>
                <div class="loading-dot"></div>
            </div>
            <div class="loading-time" id="loading-time">0.0s</div>
        </div>
        
        <div class="text-scene" id="text-scene">
            <div class="reading-cursor hidden" id="reading-cursor"></div>
            
            <h1 class="paragraph" style="font-size: 22px; margin-bottom: 1rem; transform: translateZ(10px);">
                <span class="word gradient-text">Dimensional</span>
                <span class="word">Wisdom</span>
            </h1>
            
            <div class="subtitle-line">Ancient echoes across time and space</div>
            
            <p class="paragraph">
                <span class="word">In</span>
                <span class="word-group">
                    <span class="word">the</span>
                    <span class="word foreground pulse-glow">depths</span>
                </span>
                <span class="word">of</span>
                <span class="word background">perception,</span>
                <span class="word-group">
                    <span class="word">where</span>
                    <span class="word substitution" id="word-1" tabindex="0">
                        <span class="original-text">consciousness</span>
                        <span class="alternative-text">awareness</span>
                    </span>
                </span>
                <span class="word foreground floating">flows</span>
                <span class="word-group tight-space">
                    <span class="word">like</span>
                    <span class="word background">water,</span>
                </span>
                <span class="word-group">
                    <span class="word">we</span>
                    <span class="word">discover</span>
                </span>
                <span class="word">the</span>
                <span class="word gradient-text">essence</span>
                <span class="word">of</span>
                <span class="word">being.</span>
            </p>
            
            <div class="centered-poetry">
                <div class="poetry-line">
                    <span class="foreign-text chinese" data-translation="Between being and non-being, the only difference is in name" data-source="Zhuangzi" tabindex="0">有無之間，其名為差</span>
                </div>
                <div class="poetry-line">
                    <span class="foreign-text chinese" data-translation="Once I dreamt I was a butterfly, now I wonder if I am a butterfly dreaming I'm a man" data-source="Zhuangzi" tabindex="0">昔者莊周夢為蝴蝶，今者蝴蝶夢為莊周</span>
                </div>
            </div>
            
            <p class="paragraph">
                <span class="word-group">
                    <span class="word">Each</span>
                    <span class="word">tradition</span>
                </span>
                <span class="word">points</span>
                <span class="word">to</span>
                <span class="word-group">
                    <span class="word">the</span>
                    <span class="word foreground">ineffable</span>
                </span>
                <span class="word">nature</span>
                <span class="word">of</span>
                <span class="word-group">
                    <span class="word background">reality,</span>
                </span>
                <span class="word">where</span>
                <span class="word substitution" id="word-5" tabindex="0">
                    <span class="original-text">boundaries</span>
                    <span class="alternative-text">distinctions</span>
                </span>
                <span class="word">dissolve</span>
                <span class="word">and</span>
                <span class="word">the</span>
                <span class="word gradient-text">observer</span>
                <span class="word">becomes</span>
                <span class="word">the</span>
                <span class="word foreground floating">observed.</span>
            </p>
            
            <div class="centered-poetry">
                <div class="poetry-line">
                    <span class="foreign-text persian" data-translation="You are not a drop in the ocean. You are the entire ocean in a drop." data-source="Jalal ad-Din Muhammad Rumi" tabindex="0">تو قطره‌ای در اقیانوس نیستی، تو تمام اقیانوس در یک قطره هستی</span>
                </div>
                <div class="poetry-line">
                    <span class="foreign-text persian" data-translation="What you seek is seeking you." data-source="Jalal ad-Din Muhammad Rumi" tabindex="0">آنچه می‌جویی، جویای توست</span>
                </div>
                <div class="poetry-line">
                    <span class="foreign-text persian" data-translation="Let yourself be silently drawn by the strange pull of what you really love." data-source="Jalal ad-Din Muhammad Rumi" tabindex="0">بگذار خاموشانه جذب کششِ عجیبِ آنچه واقعاً دوستش داری، شوی</span>
                </div>
            </div>
            
            <p class="paragraph">
                <span class="word">The</span>
                <span class="word-group">
                    <span class="word">ancient</span>
                    <span class="word background">wisdom</span>
                </span>
                <span class="word">of</span>
                <span class="word">both</span>
                <span class="word foreground">East</span>
                <span class="word">and</span>
                <span class="word foreground">West</span>
                <span class="word">converges</span>
                <span class="word">on</span>
                <span class="word">a</span>
                <span class="word-group">
                    <span class="word">profound</span>
                    <span class="word substitution" id="word-6" tabindex="0">
                        <span class="original-text">paradox:</span>
                        <span class="alternative-text">mystery:</span>
                    </span>
                </span>
                <span class="word">that</span>
                <span class="word">we</span>
                <span class="word">are</span>
                <span class="word-group">
                    <span class="word">both</span>
                    <span class="word background">separate</span>
                </span>
                <span class="word-group">
                    <span class="word">and</span>
                    <span class="word background">whole,</span>
                </span>
                <span class="word-group">
                    <span class="word">both</span>
                    <span class="word gradient-text">finite</span>
                </span>
                <span class="word-group">
                    <span class="word">and</span>
                    <span class="word gradient-text">infinite.</span>
                </span>
            </p>
            
            <div id="translation-tooltip" class="translation-tooltip">
                <div id="tooltip-text"></div>
                <div id="tooltip-source" class="translation-origin"></div>
            </div>
            
            <div id="tap-feedback" class="tap-feedback"></div>
        </div>
        
        <div class="settings-panel">
            <div class="settings-button" id="settings-toggle" aria-label="Settings" role="button" tabindex="0">
                ⚙️
            </div>
        </div>
        
        <div class="settings-panel-expanded" id="settings-panel">
            <div class="settings-title">Typography Settings</div>
            
            <div class="settings-row">
                <div class="settings-label">Depth Intensity</div>
                <div class="slider-container">
                    <input type="range" min="0" max="100" value="50" class="slider" id="depth-slider" aria-label="Adjust depth intensity">
                </div>
            </div>
            
            <div class="settings-row">
                <div class="settings-label">Parallax Sensitivity</div>
                <div class="slider-container">
                    <input type="range" min="0" max="100" value="50" class="slider" id="parallax-slider" aria-label="Adjust parallax sensitivity">
                </div>
            </div>
            
            <div class="settings-row">
                <div class="settings-label">Glow Intensity</div>
                <div class="slider-container">
                    <input type="range" min="0" max="100" value="50" class="slider" id="glow-slider" aria-label="Adjust glow intensity">
                </div>
            </div>
            
            <div class="settings-row">
                <div class="settings-label">Reading Guide</div>
                <label class="toggle-switch">
                    <input type="checkbox" id="reading-cursor-toggle" aria-label="Toggle reading guide">
                    <span class="toggle-slider"></span>
                </label>
            </div>
            
            <div class="settings-row">
                <div class="settings-label">Dark Mode</div>
                <label class="toggle-switch">
                    <input type="checkbox" checked id="dark-mode-toggle" aria-label="Toggle dark mode">
                    <span class="toggle-slider"></span>
                </label>
            </div>
        </div>
    </div> chinese" data-translation="The Way that can be told is not the eternal Way" data-source="Tao Te Ching, Chapter 1" tabindex="0">道可道，非常道</span>
                </div>
                <div class="poetry-line">
                    <span class="foreign-text chinese" data-translation="The name that can be named is not the eternal name" data-source="Tao Te Ching, Chapter 1" tabindex="0">名可名，非常名</span>
                </div>
                <div class="poetry-line">
                    <span class="foreign-text chinese" data-translation="The nameless is the origin of Heaven and Earth" data-source="Tao Te Ching, Chapter 1" tabindex="0">無名天地之始</span>
                </div>
                <div class="poetry-line">
                    <span class="foreign-text chinese" data-translation="The named is the mother of all things" data-source="Tao Te Ching, Chapter 1" tabindex="0">有名萬物之母</span>
                </div>
            </div>
            
            <p class="paragraph">
                <span class="word-group">
                    <span class="word">Laozi</span>
                    <span class="word background">reminds</span>
                    <span class="word">us</span>
                </span>
                <span class="word">that</span>
                <span class="word substitution" id="word-2" tabindex="0">
                    <span class="original-text">truth</span>
                    <span class="alternative-text">reality</span>
                </span>
                <span class="word">exists</span>
                <span class="word">beyond</span>
                <span class="word">language,</span>
                <span class="word">beyond</span>
                <span class="word-group">
                    <span class="word">our</span>
                    <span class="word foreground pulse-glow">comprehension.</span>
                </span>
                <span class="word">The</span>
                <span class="word substitution" id="word-3" tabindex="0">
                    <span class="original-text">mysteries</span>
                    <span class="alternative-text">secrets</span>
                </span>
                <span class="word">of</span>
                <span class="word background">existence</span>
                <span class="word">remain</span>
                <span class="word-group">
                    <span class="word">beyond</span>
                    <span class="word">words.</span>
                </span>
            </p>
            
            <div class="centered-poetry">
                <div class="poetry-line">
                    <span class="foreign-text persian" data-translation="Beyond ideas of wrongdoing and rightdoing there is a field." data-source="Jalal ad-Din Muhammad Rumi, Masnavi" tabindex="0">آن سوی اندیشه‌های بد و خوب، دشتی است</span>
                </div>
                <div class="poetry-line">
                    <span class="foreign-text persian" data-translation="I'll meet you there. When the soul lies down in that grass" data-source="Jalal ad-Din Muhammad Rumi, Masnavi" tabindex="0">آنجا با تو دیدار می‌کنم. آنجا که روح در آن چمن می‌آرامد</span>
                </div>
                <div class="poetry-line">
                    <span class="foreign-text persian" data-translation="The world is too full to talk about. Ideas, language, even the phrase 'each other'" data-source="Jalal ad-Din Muhammad Rumi, Masnavi" tabindex="0">جهان برای گفتن پر است. اندیشه‌ها، زبان، حتی عبارت 'یکدیگر'</span>
                </div>
                <div class="poetry-line">
                    <span class="foreign-text persian" data-translation="Doesn't make any sense." data-source="Jalal ad-Din Muhammad Rumi, Masnavi" tabindex="0">هیچ معنایی ندارد</span>
                </div>
            </div>
            
            <p class="paragraph">
                <span class="word-group">
                    <span class="word">And</span>
                    <span class="word background">Rumi</span>
                </span>
                <span class="word">beckons</span>
                <span class="word">us</span>
                <span class="word">to</span>
                <span class="word foreground floating">transcend</span>
                <span class="word">our</span>
                <span class="word-group">
                    <span class="word">limited</span>
                    <span class="word">perspective,</span>
                </span>
                <span class="word">to</span>
                <span class="word">find</span>
                <span class="word">that</span>
                <span class="word gradient-text">field</span>
                <span class="word">beyond</span>
                <span class="word substitution" id="word-4" tabindex="0">
                    <span class="original-text">judgment</span>
                    <span class="alternative-text">duality</span>
                </span>
                <span class="word">where</span>
                <span class="word-group">
                    <span class="word">true</span>
                    <span class="word background">connection</span>
                </span>
                <span class="word">becomes</span>
                <span class="word">possible.</span>
            </p>
            
            <div class="centered-poetry">
                <div class="poetry-line">
                  <span class="foreign-text persian" data-translation="I'll meet you there. When the soul lies down in that grass" data-source="Jalal ad-Din Muhammad Rumi, Masnavi" tabindex="0">آنجا با تو دیدار می‌کنم. آنجا که روح در آن چمن می‌آرامد</span>
                </div>
                <div class="poetry-line">
                    <span class="foreign-text persian" data-translation="The world is too full to talk about. Ideas, language, even the phrase 'each other'" data-source="Jalal ad-Din Muhammad Rumi, Masnavi" tabindex="0">جهان برای گفتن پر است. اندیشه‌ها، زبان، حتی عبارت 'یکدیگر'</span>
                </div>
                <div class="poetry-line">
                    <span class="foreign-text persian" data-translation="Doesn't make any sense." data-source="Jalal ad-Din Muhammad Rumi, Masnavi" tabindex="0">هیچ معنایی ندارد</span>
                </div>
            </div>
            
            <p class="paragraph">
                <span class="word-group">
                    <span class="word">And</span>
                    <span class="word background">Rumi</span>
                </span>
                <span class="word">beckons</span>
                <span class="word">us</span>
                <span class="word">to</span>
                <span class="word foreground floating">transcend</span>
                <span class="word">our</span>
                <span class="word-group">
                    <span class="word">limited</span>
                    <span class="word">perspective,</span>
                </span>
                <span class="word">to</span>
                <span class="word">find</span>
                <span class="word">that</span>
                <span class="word gradient-text">field</span>
                <span class="word">beyond</span>
                <span class="word multi-substitution" id="word-4" tabindex="0" data-word="judgment" 
                data-alternatives="duality,polarization,conflict,discrimination,comparison,evaluation,assessment,critique,division,separation">
                    <span class="current-text">judgment</span>
                </span>
                <span class="word">where</span>
                <span class="word-group">
                    <span class="word">true</span>
                    <span class="word background">connection</span>
                </span>
                <span class="word">becomes</span>
                <span class="word">possible.</span>
            </p>
            
            <div class="centered-poetry">
                <div class="poetry-line">
                    <span class="foreign-text chinese" data-translation="Between being and non-being, the only difference is in name" data-source="Zhuangzi" tabindex="0" data-interlinear="yǒu wú zhī jiān, qí míng wéi chā">有無之間，其名為差</span>
                </div>
                <div class="poetry-line">
                    <span class="foreign-text chinese" data-translation="Once I dreamt I was a butterfly, now I wonder if I am a butterfly dreaming I'm a man" data-source="Zhuangzi" tabindex="0" data-interlinear="xī zhě zhuāng zhōu mèng wéi hú dié, jīn zhě hú dié mèng wéi zhuāng zhōu">昔者莊周夢為蝴蝶，今者蝴蝶夢為莊周</span>
                </div>
            </div>
            
            <p class="paragraph">
                <span class="word-group">
                    <span class="word">Each</span>
                    <span class="word">tradition</span>
                </span>
                <span class="word">points</span>
                <span class="word">to</span>
                <span class="word-group">
                    <span class="word">the</span>
                    <span class="word foreground">ineffable</span>
                </span>
                <span class="word">nature</span>
                <span class="word">of</span>
                <span class="word-group">
                    <span class="word background">reality,</span>
                </span>
                <span class="word">where</span>
                <span class="word multi-substitution" id="word-5" tabindex="0" data-word="boundaries" 
                data-alternatives="distinctions,divisions,separations,demarcations,limits,borders,confines,delineations,thresholds,partitions">
                    <span class="current-text">boundaries</span>
                </span>
                <span class="word">dissolve</span>
                <span class="word">and</span>
                <span class="word">the</span>
                <span class="word gradient-text">observer</span>
                <span class="word">becomes</span>
                <span class="word">the</span>
                <span class="word foreground floating">observed.</span>
            </p>
            
            <div class="centered-poetry">
                <div class="poetry-line">
                    <span class="foreign-text persian" data-translation="You are not a drop in the ocean. You are the entire ocean in a drop." data-source="Jalal ad-Din Muhammad Rumi" tabindex="0">تو قطره‌ای در اقیانوس نیستی، تو تمام اقیانوس در یک قطره هستی</span>
                </div>
                <div class="poetry-line">
                    <span class="foreign-text persian" data-translation="What you seek is seeking you." data-source="Jalal ad-Din Muhammad Rumi" tabindex="0">آنچه می‌جویی، جویای توست</span>
                </div>
                <div class="poetry-line">
                    <span class="foreign-text persian" data-translation="Let yourself be silently drawn by the strange pull of what you really love." data-source="Jalal ad-Din Muhammad Rumi" tabindex="0">بگذار خاموشانه جذب کششِ عجیبِ آنچه واقعاً دوستش داری، شوی</span>
                </div>
            </div>
            
            <p class="paragraph">
                <span class="word">The</span>
                <span class="word-group">
                    <span class="word">ancient</span>
                    <span class="word background">wisdom</span>
                </span>
                <span class="word">of</span>
                <span class="word">both</span>
                <span class="word foreground">East</span>
                <span class="word">and</span>
                <span class="word foreground">West</span>
                <span class="word">converges</span>
                <span class="word">on</span>
                <span class="word">a</span>
                <span class="word-group">
                    <span class="word">profound</span>
                    <span class="word multi-substitution" id="word-6" tabindex="0" data-word="paradox" 
                    data-alternatives="mystery,enigma,contradiction,conundrum,riddle,dilemma,quandary,irony,incongruity,ambiguity">
                        <span class="current-text">paradox</span>
                    </span>
                </span>
                <span class="word">that</span>
                <span class="word">we</span>
                <span class="word">are</span>
                <span class="word-group">
                    <span class="word">both</span>
                    <span class="word background">separate</span>
                </span>
                <span class="word-group">
                    <span class="word">and</span>
                    <span class="word background">whole,</span>
                </span>
                <span class="word-group">
                    <span class="word">both</span>
                    <span class="word gradient-text">finite</span>
                </span>
                <span class="word-group">
                    <span class="word">and</span>
                    <span class="word gradient-text">infinite.</span>
                </span>
            </p>
            
            <div id="translation-tooltip" class="translation-tooltip">
                <div id="tooltip-text"></div>
                <div id="tooltip-source" class="translation-origin"></div>
            </div>

            <!-- Semantic neighborhood visualization -->
            <div id="semantic-map" class="semantic-map">
                <div class="semantic-map-inner">
                    <div class="semantic-map-title">Semantic Neighborhood</div>
                    <div class="semantic-map-content">
                        <canvas id="semantic-canvas"></canvas>
                    </div>
                    <div class="semantic-map-footer">
                        <button id="semantic-close">Close</button>
                    </div>
                </div>
            </div>
            
            <div id="tap-feedback" class="tap-feedback"></div>
        </div>
        
        <div class="settings-panel">
            <div class="settings-button" id="settings-toggle" aria-label="Settings" role="button" tabindex="0">
                ⚙️
            </div>
        </div>
        
        <div class="settings-panel-expanded" id="settings-panel">
            <div class="settings-title">Typography Settings</div>
            
            <div class="settings-row">
                <div class="settings-label">Depth Intensity</div>
                <div class="slider-container">
                    <input type="range" min="0" max="100" value="50" class="slider" id="depth-slider" aria-label="Adjust depth intensity">
                </div>
            </div>
            
            <div class="settings-row">
                <div class="settings-label">Parallax Sensitivity</div>
                <div class="slider-container">
                    <input type="range" min="0" max="100" value="50" class="slider" id="parallax-slider" aria-label="Adjust parallax sensitivity">
                </div>
            </div>
            
            <div class="settings-row">
                <div class="settings-label">Glow Intensity</div>
                <div class="slider-container">
                    <input type="range" min="0" max="100" value="50" class="slider" id="glow-slider" aria-label="Adjust glow intensity">
                </div>
            </div>
            
            <div class="settings-row">
                <div class="settings-label">Reading Guide</div>
                <label class="toggle-switch">
                    <input type="checkbox" id="reading-cursor-toggle" aria-label="Toggle reading guide">
                    <span class="toggle-slider"></span>
                </label>
            </div>
            
            <div class="settings-row">
                <div class="settings-label">Dark Mode</div>
                <label class="toggle-switch">
                    <input type="checkbox" checked id="dark-mode-toggle" aria-label="Toggle dark mode">
                    <span class="toggle-slider"></span>
                </label>
            </div>
        </div>
    </div>

    <style>
        /* Interlinear translation for Chinese text */
        .foreign-text.chinese {
            position: relative;
        }
        
        .interlinear-text {
            position: absolute;
            left: 0;
            top: 100%;
            width: 100%;
            font-size: 0.7em;
            color: var(--accent-mint);
            opacity: 0.7;
            text-align: center;
            padding-top: 0.3em;
            font-family: 'Menlo', monospace;
            font-style: italic;
            font-weight: normal;
            transform: translateZ(4px);
            pointer-events: none;
            transition: opacity 0.3s ease, transform 0.3s ease;
            opacity: 0;
            transform: translateY(-5px);
        }
        
        .foreign-text.chinese.show-interlinear .interlinear-text {
            opacity: 1;
            transform: translateY(0);
        }
        
        /* Semantic neighborhood visualization */
        .semantic-map {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(5, 10, 20, 0.85);
            backdrop-filter: blur(10px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.4s var(--transition-smooth), visibility 0.4s var(--transition-smooth);
        }
        
        .semantic-map.visible {
            opacity: 1;
            visibility: visible;
        }
        
        .semantic-map-inner {
            width: 90%;
            height: 90%;
            max-width: 350px;
            max-height: 600px;
            background: rgba(20, 30, 50, 0.9);
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            border: 1px solid var(--accent-cyan);
            box-shadow: 0 0 30px rgba(100, 200, 255, 0.3);
            overflow: hidden;
        }
        
        .semantic-map-title {
            padding: 1rem;
            text-align: center;
            font-size: 18px;
            font-weight: 500;
            color: var(--text-primary);
            border-bottom: 1px solid rgba(100, 200, 255, 0.2);
            background: rgba(30, 40, 60, 0.8);
        }
        
        .semantic-map-content {
            flex: 1;
            padding: 1rem;
            overflow: hidden;
            position: relative;
        }
        
        .semantic-map-footer {
            padding: 1rem;
            display: flex;
            justify-content: center;
            border-top: 1px solid rgba(100, 200, 255, 0.2);
        }
        
        .semantic-map-footer button {
            background: rgba(100, 200, 255, 0.2);
            border: 1px solid rgba(100, 200, 255, 0.4);
            color: var(--text-primary);
            padding: 0.6rem 2rem;
            border-radius: 30px;
            font-family: 'Menlo', monospace;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .semantic-map-footer button:hover {
            background: rgba(100, 200, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }
        
        .semantic-node {
            position: absolute;
            background: rgba(100, 200, 255, 0.1);
            border: 1px solid rgba(100, 200, 255, 0.3);
            color: var(--text-primary);
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 14px;
            transition: all 0.2s ease;
            cursor: pointer;
            text-align: center;
            transform: translate(-50%, -50%);
        }
        
        .semantic-node:hover {
            background: rgba(100, 200, 255, 0.2);
            transform: translate(-50%, -50%) scale(1.1);
            z-index: 10;
        }
        
        .semantic-node.central {
            background: rgba(100, 200, 255, 0.3);
            border: 2px solid rgba(100, 200, 255, 0.6);
            font-weight: bold;
            z-index: 5;
            padding: 8px 16px;
            font-size: 16px;
        }
        
        .semantic-node.selected {
            background: rgba(150, 255, 180, 0.3);
            border: 2px solid rgba(150, 255, 180, 0.6);
            color: var(--accent-mint);
            text-shadow: 0 0 8px var(--glow-mint);
        }
    </style>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Elements
            const textScene = document.getElementById('text-scene');
            const translationTooltip = document.getElementById('translation-tooltip');
            const tooltipText = document.getElementById('tooltip-text');
            const tooltipSource = document.getElementById('tooltip-source');
            const settingsToggle = document.getElementById('settings-toggle');
            const settingsPanel = document.getElementById('settings-panel');
            const readingCursor = document.getElementById('reading-cursor');
            const tapFeedback = document.getElementById('tap-feedback');
            const semanticMap = document.getElementById('semantic-map');
            const semanticCanvas = document.getElementById('semantic-canvas');
            const semanticClose = document.getElementById('semantic-close');
            
            // Variables for tracking state
            let lastX = 0;
            let lastY = 0;
            let isMoving = false;
            let isReadingActive = false;
            let activeTooltipElement = null;
            let currentMultiWord = null;
            
            // Tap timing for triple tap detection
            let tapCount = 0;
            let lastTapTime = 0;
            let tapTimer = null;
            
            // Settings variables
            let depthIntensity = 0.5;
            let parallaxSensitivity = 0.5;
            let glowIntensity = 0.5;
            let isDarkMode = true;
            
            // Initialize sliders and toggles
            const depthSlider = document.getElementById('depth-slider');
            const parallaxSlider = document.getElementById('parallax-slider');
            const glowSlider = document.getElementById('glow-slider');
            const darkModeToggle = document.getElementById('dark-mode-toggle');
            const readingCursorToggle = document.getElementById('reading-cursor-toggle');
            
            // Add interlinear text elements to Chinese text
            function setupInterlinearText() {
                const chineseTexts = document.querySelectorAll('.foreign-text.chinese');
                
                chineseTexts.forEach(text => {
                    const interlinear = text.getAttribute('data-interlinear');
                    if (interlinear) {
                        // Create interlinear element
                        const interlinearElement = document.createElement('div');
                        interlinearElement.className = 'interlinear-text';
                        interlinearElement.textContent = interlinear;
                        text.appendChild(interlinearElement);
                        
                        // Add click handler to toggle interlinear
                        text.addEventListener('click', function(e) {
                            e.preventDefault();
                            this.classList.toggle('show-interlinear');
                            
                            // Show tap feedback
                            showTapFeedback(e.clientX, e.clientY);
                        });
                    }
                });
            }
            
            // Initialize text depths with subtle variations
            function initializeTextDepths() {
                // Set random z-depths for regular words
                const words = document.querySelectorAll('.word:not(.foreground):not(.background):not(.multi-substitution):not(.gradient-text)');
                words.forEach(word => {
                    // Create more subtle and natural depth variations
                    const zDepth = (Math.random() * 5 - 2.5).toFixed(2);
                    word.style.transform = `translateZ(${zDepth}px)`;
                    
                    // Add subtle glow to some words
                    if (Math.random() > 0.7) {
                        const hue = 190 + Math.random() * 40;
                        const intensity = 0.2 + Math.random() * 0.3;
                        word.style.textShadow = `0 0 5px hsla(${hue}, 80%, 70%, ${intensity})`;
                    }
                });
                
                // Add slight rotations to some words for more organic feel
                document.querySelectorAll('.word').forEach(word => {
                    if (Math.random() > 0.7) {
                        const rotateX = (Math.random() * 2 - 1).toFixed(2);
                        const rotateY = (Math.random() * 2 - 1).toFixed(2);
                        const currentTransform = word.style.transform || '';
                        
                        if (!currentTransform.includes('rotate')) {
                            word.style.transform = `${currentTransform} rotateX(${rotateX}deg) rotateY(${rotateY}deg)`;
                        }
                    }
                });
            }
            
            // Handle multi-substitution words
            function setupMultiSubstitutions() {
                const substitutionWords = document.querySelectorAll('.multi-substitution');
                
                substitutionWords.forEach(word => {
                    let tapCount = 0;
                    let lastTapTime = 0;
                    
                    // Store original word and alternatives
                    const originalWord = word.getAttribute('data-word');
                    const alternatives = word.getAttribute('data-alternatives').split(',');
                    const allWords = [originalWord, ...alternatives];
                    
                    // Set up click handler for word cycling
                    word.addEventListener('click', function(e) {
                        e.preventDefault();
                        showTapFeedback(e.clientX, e.clientY);
                        
                        // Get current displayed text
                        const currentText = word.querySelector('.current-text').textContent;
                        
                        // Find current index in all words
                        const currentIndex = allWords.indexOf(currentText);
                        const nextIndex = (currentIndex + 1) % allWords.length;
                        
                        // Update displayed text
                        word.querySelector('.current-text').textContent = allWords[nextIndex];
                        
                        // Track tap timing for triple tap detection
                        const now = Date.now();
                        if (now - lastTapTime < 500) { // Within 500ms
                            tapCount++;
                            
                            if (tapCount === 3) { // Triple tap detected
                                // Show semantic map
                                showSemanticMap(word, currentText, allWords);
                                tapCount = 0;
                            }
                        } else {
                            tapCount = 1;
                        }
                        
                        lastTapTime = now;
                    });
                    
                    // Keyboard accessibility
                    word.addEventListener('keydown', function(e) {
                        if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            this.click();
                        }
                    });
                });
            }
            
            // Show semantic neighborhood map
            function showSemanticMap(wordElement, currentWord, allWords) {
                // Store current word for returning to the main view
                currentMultiWord = wordElement;
                
                // Set up canvas
                const canvas = semanticCanvas;
                const ctx = canvas.getContext('2d');
                
                // Set canvas dimensions
                canvas.width = semanticMap.querySelector('.semantic-map-content').offsetWidth;
                canvas.height = semanticMap.querySelector('.semantic-map-content').offsetHeight;
                
                // Clear any existing nodes
                const contentDiv = semanticMap.querySelector('.semantic-map-content');
                while (contentDiv.querySelector('.semantic-node')) {
                    contentDiv.removeChild(contentDiv.querySelector('.semantic-node'));
                }
                
                // Create radar/radial map
                createRadarMap(contentDiv, currentWord, allWords);
                
                // Show the semantic map
                semanticMap.classList.add('visible');
            }
            
            // Create radar/radial map of semantic neighbors
            function createRadarMap(container, centralWord, neighbors) {
                // Calculate center and radius
                const centerX = container.offsetWidth / 2;
                const centerY = container.offsetHeight / 2;
                const maxRadius = Math.min(centerX, centerY) * 0.85;
                
                // Create central node
                const centralNode = document.createElement('div');
                centralNode.className = 'semantic-node central';
                centralNode.textContent = centralWord;
                centralNode.style.left = `${centerX}px`;
                centralNode.style.top = `${centerY}px`;
                container.appendChild(centralNode);
                
                // Create neighbor nodes in a circular pattern
                neighbors.forEach((word, index) => {
                    if (word === centralWord) return; // Skip central word
                    
                    // Calculate position on the circle
                    const angle = (index / neighbors.length) * 2 * Math.PI;
                    const distance = 0.4 + Math.random() * 0.5; // Randomize distance between 0.4 and 0.9 of radius
                    const x = centerX + Math.cos(angle) * maxRadius * distance;
                    const y = centerY + Math.sin(angle) * maxRadius * distance;
                    
                    // Create node
                    const node = document.createElement('div');
                    node.className = 'semantic-node';
                    node.textContent = word;
                    node.style.left = `${x}px`;
                    node.style.top = `${y}px`;
                    
                    // Handle node selection
                    node.addEventListener('click', function() {
                        // Update word in the main view
                        if (currentMultiWord) {
                            currentMultiWord.querySelector('.current-text').textContent = word;
                            
                            // Create selection effect
                            document.querySelectorAll('.semantic-node').forEach(n => n.classList.remove('selected'));
                            this.classList.add('selected');
                            
                            // Close after a short delay
                            setTimeout(() => {
                                semanticMap.classList.remove('visible');
                            }, 800);
                        }
                    });
                    
                    container.appendChild(node);
                });
                
                // Draw connecting lines on canvas
                const canvas = semanticCanvas;
                const ctx = canvas.getContext('2d');
                
                // Clear canvas
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Draw connecting lines from central node to others
                const nodes = container.querySelectorAll('.semantic-node:not(.central)');
                ctx.strokeStyle = 'rgba(100, 200, 255, 0.2)';
                ctx.lineWidth = 1;
                
                nodes.forEach(node => {
                    const x = parseFloat(node.style.left);
                    const y = parseFloat(node.style.top);
                    
                    ctx.beginPath();
                    ctx.moveTo(centerX, centerY);
                    ctx.lineTo(x, y);
                    ctx.stroke();
                });
            }
            
            // Close semantic map
            semanticClose.addEventListener('click', function() {
                semanticMap.classList.remove('visible');
            });
            
            // Handle foreign text translations
            function setupTranslations() {
                const foreignTexts = document.querySelectorAll('.foreign-text');
                
                foreignTexts.forEach(text => {
                    const translation = text.getAttribute('data-translation');
                    const source = text.getAttribute('data-source');
                    
                    // Touch handling
                    text.addEventListener('touchstart', function(e) {
                        longPressTimer = setTimeout(function() {
                            showTranslation(text, translation, source);
                            activeTooltipElement = text;
                            
                            // Vibrate if available
                            if (navigator.vibrate) {
                                navigator.vibrate(50);
                            }
                        }, 500); // Show after 500ms hold
                    }, { passive: true });
                    
                    text.addEventListener('touchend', function() {
                        clearTimeout(longPressTimer);
                        
                        // Hide tooltip after a delay if this is the active element
                        if (activeTooltipElement === text) {
                            setTimeout(() => {
                                if (activeTooltipElement === text) {
                                    translationTooltip.classList.remove('visible');
                                    activeTooltipElement = null;
                                }
                            }, 2000);
                        }
                    });
                    
                    // Click for desktop - handled differently for Chinese texts with interlinear
                    if (!text.classList.contains('chinese')) {
                        text.addEventListener('click', function(e) {
                            showTapFeedback(e.clientX, e.clientY);
                            showTranslation(text, translation, source);
                            activeTooltipElement = text;
                        });
                    }
                    
                    // Keyboard accessibility
                    text.addEventListener('keydown', function(e) {
                        if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            showTranslation(text, translation, source);
                            activeTooltipElement = text;
                        }
                    });
                });
                
                // Hide tooltip when clicking elsewhere
                document.addEventListener('click', function(e) {
                    if (!e.target.closest('.foreign-text') && !e.target.closest('.translation-tooltip')) {
                        translationTooltip.classList.remove('visible');
                        activeTooltipElement = null;
                    }
                });
            }
            
            function showTranslation(element, translation, source) {
                // Calculate position for tooltip
                const rect = element.getBoundingClientRect();
                const containerRect = textScene.getBoundingClientRect();
                
                // Position the tooltip
                if (element.classList.contains('persian')) {
                    // For right-to-left text, position differently
                    translationTooltip.style.top = (rect.top - containerRect.top + rect.height + 15) + 'px';
                    translationTooltip.style.left = Math.max(10, Math.min(containerRect.width - 300, 
                        rect.left - containerRect.left)) + 'px';
                    translationTooltip.style.transformOrigin = '10% 0';
                } else {
                    translationTooltip.style.top = (rect.top - containerRect.top + rect.height + 15) + 'px';
                    translationTooltip.style.left = Math.max(10, Math.min(containerRect.width - 300, 
                        rect.left - containerRect.left - 140 + rect.width / 2)) + 'px';
                    translationTooltip.style.transformOrigin = '50% 0';
                }
                
                // Set content and show
                tooltipText.textContent = translation;
                tooltipSource.textContent = source;
                translationTooltip.classList.add('visible');
            }
            
            // Settings panel toggle
            function setupSettingsPanel() {
                settingsToggle.addEventListener('click', function(e) {
                    showTapFeedback(e.clientX, e.clientY);
                    settingsPanel.classList.toggle('visible');
                });
                
                // Close when clicking outside
                document.addEventListener('click', function(e) {
                    if (settingsPanel.classList.contains('visible') && 
                        !e.target.closest('.settings-panel') && 
                        !e.target.closest('.settings-button')) {
                        settingsPanel.classList.remove('visible');
                    }
                });
                
                // Keyboard accessibility
                settingsToggle.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        this.click();
                    }
                });
            }
            
            // Update settings from sliders
            function setupSettingsControls() {
                depthSlider.addEventListener('input', function() {
                    depthIntensity = this.value / 100;
                    updateDepthIntensity();
                });
                
                parallaxSlider.addEventListener('input', function() {
                    parallaxSensitivity = this.value / 100;
                });
                
                glowSlider.addEventListener('input', function() {
                    glowIntensity = this.value / 100;
                    updateGlowIntensity();
                });
                
                darkModeToggle.addEventListener('change', function() {
                    isDarkMode = this.checked;
                    updateColorScheme();
                });
                
                readingCursorToggle.addEventListener('change', function() {
                    isReadingActive = this.checked;
                    if (isReadingActive) {
                        readingCursor.classList.remove('hidden');
                    } else {
                        readingCursor.classList.add('hidden');
                    }
                });
            }
            
            function updateDepthIntensity() {
                // Calculate depths based on intensity
                const foregroundDepth = 4 + (depthIntensity * 10);
                const backgroundDepth = -4 - (depthIntensity * 10);
                
                // Update CSS custom properties
                document.documentElement.style.setProperty('--depth-foreground', `${foregroundDepth}px`);
                document.documentElement.style.setProperty('--depth-background', `${backgroundDepth}px`);
                
                // Apply to existing elements with specific classes
                document.querySelectorAll('.foreground').forEach(word => {
                    const currentTransform = word.style.transform || '';
                    word.style.transform = currentTransform.replace(/translateZ\([^)]*\)/, `translateZ(${foregroundDepth}px)`);
                });
                
                document.querySelectorAll('.background').forEach(word => {
                    const currentTransform = word.style.transform || '';
                    word.style.transform = currentTransform.replace(/translateZ\([^)]*\)/, `translateZ(${backgroundDepth}px)`);
                });
                
                // Update floating animation
                document.querySelectorAll('.floating').forEach(word => {
                    word.style.animationName = 'none';
                    setTimeout(() => {
                        word.style.animationName = 'float';
                    }, 10);
                });
            }
            
            function updateGlowIntensity() {
                // Calculate glow amounts based on intensity
                const foregroundGlow = 3 + (glowIntensity * 15);
                const glowColor = `rgba(100, 200, 255, ${glowIntensity * 0.5 + 0.2})`;
                
                // Update CSS custom properties
                document.documentElement.style.setProperty('--glow-cyan', glowColor);
                
                // Apply to specific elements
                document.querySelectorAll('.pulse-glow').forEach(word => {
                    word.style.animationName = 'none';
                    setTimeout(() => {
                        word.style.animationName = 'pulse';
                    }, 10);
                });
                
                document.querySelectorAll('.foreground:not(.pulse-glow)').forEach(word => {
                    word.style.textShadow = `0 0 ${foregroundGlow}px ${glowColor}`;
                });
                
                // Update other glow elements
                document.querySelectorAll('.multi-substitution').forEach(word => {
                    word.style.textShadow = `0 0 ${glowIntensity * 8 + 2}px ${glowColor}`;
                });
            }
            
            function updateColorScheme() {
                const container = document.querySelector('.iphone-container');
                
                if (isDarkMode) {
                    // Dark mode colors
                    document.documentElement.style.setProperty('--bg-primary', '#0a0a12');
                    document.documentElement.style.setProperty('--bg-secondary', '#12121e');
                    document.documentElement.style.setProperty('--bg-tertiary', '#1a1a2e');
                    document.documentElement.style.setProperty('--text-primary', 'rgba(230, 230, 240, 0.94)');
                    document.documentElement.style.setProperty('--text-secondary', 'rgba(200, 200, 220, 0.85)');
                    document.documentElement.style.setProperty('--text-tertiary', 'rgba(170, 170, 190, 0.75)');
                    
                    container.style.background = 'linear-gradient(135deg, var(--bg-primary), var(--bg-tertiary))';
                } else {
                    // Light mode colors
                    document.documentElement.style.setProperty('--bg-primary', '#f0f0f8');
                    document.documentElement.style.setProperty('--bg-secondary', '#e8e8f0');
                    document.documentElement.style.setProperty('--bg-tertiary', '#e0e0ee');
                    document.documentElement.style.setProperty('--text-primary', 'rgba(40, 40, 60, 0.94)');
                    document.documentElement.style.setProperty('--text-secondary', 'rgba(60, 60, 80, 0.85)');
                    document.documentElement.style.setProperty('--text-tertiary', 'rgba(80, 80, 100, 0.75)');
                    
                    container.style.background = 'linear-gradient(135deg, var(--bg-primary), var(--bg-tertiary))';
                }
                
                // Update all word colors that aren't special classes
                document.querySelectorAll('.word:not(.foreground):not(.background):not(.gradient-text):not(.multi-substitution)').forEach(word => {
                    word.style.color = 'var(--text-primary)';
                });
                
                document.querySelectorAll('.background').forEach(word => {
                    word.style.color = 'var(--text-tertiary)';
                });
            }
            
            // Reading cursor functionality
            function updateReadingCursor(x, y) {
                if (!isReadingActive) return;
                
                // Find the word closest to the cursor
                const words = document.querySelectorAll('.word, .foreign-text');
                let closestWord = null;
                let closestDistance = Infinity;
                
                words.forEach(word => {
                    const rect = word.getBoundingClientRect();
                    const wordX = rect.left + rect.width / 2;
                    const wordY = rect.top + rect.height / 2;
                    
                    const distance = Math.sqrt(
                        Math.pow(wordX - x, 2) + 
                        Math.pow(wordY - y, 2)
                    );
                    
                    if (distance < closestDistance) {
                        closestDistance = distance;
                        closestWord = word;
                    }
                });
                
                if (closestWord && closestDistance < 150) {
                    const rect = closestWord.getBoundingClientRect();
                    const containerRect = textScene.getBoundingClientRect();
                    
                    readingCursor.style.left = (rect.left - containerRect.left - 5) + 'px';
                    readingCursor.style.top = (rect.top - containerRect.top) + 'px';
                    readingCursor.style.height = rect.height + 'px';
                    readingCursor.classList.remove('hidden');
                } else {
                    readingCursor.classList.add('hidden');
                }
            }
            
            // Show tap feedback effect
            function showTapFeedback(x, y) {
                // Position the feedback element
                tapFeedback.style.left = x + 'px';
                tapFeedback.style.top = y + 'px';
                
                // Trigger animation
                tapFeedback.style.animation = 'none';
                setTimeout(() => {
                    tapFeedback.style.animation = 'tap-ripple 0.6s forwards';
                }, 10);
            }
            
            // Parallax effect on mouse/touch move
            function handleMovement(clientX, clientY) {
                if (!isMoving) {
                    requestAnimationFrame(() => {
                        const containerRect = textScene.getBoundingClientRect();
                        
                        // Calculate mouse position relative to container center
                        const centerX = containerRect.left + containerRect.width / 2;
                        const centerY = containerRect.top + containerRect.height / 2;
                        
                        const deltaX = (clientX - centerX) / (containerRect.width / 2);
                        const deltaY = (clientY - centerY) / (containerRect.height / 2);
                        
                        // Apply parallax to text scene based on sensitivity
                        const rotateAmount = parallaxSensitivity * 10;
                        const moveAmount = parallaxSensitivity * 15;
                        
                        textScene.style.transform = `
                            perspective(1200px)
                            rotateY(${deltaX * rotateAmount}deg) 
                            rotateX(${-deltaY * rotateAmount}deg)
                            translateX(${deltaX * moveAmount * 0.4}px)
                            translateY(${deltaY * moveAmount * 0.4}px)
                        `;
                        
                        // Apply parallax to individual words based on their z-depth
                        document.querySelectorAll('.word, .foreign-text').forEach(word => {
                            let zDepth = 0;
                            
                            // Extract z-depth from transform if it exists
                            const transformStyle = word.style.transform || '';
                            const zMatch = transformStyle.match(/translateZ\(([^)]+)\)/);
                            if (zMatch) {
                                zDepth = parseFloat(zMatch[1]);
                            } else if (word.classList.contains('foreground')) {
                                zDepth = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--depth-foreground'));
                            } else if (word.classList.contains('background')) {
                                zDepth = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--depth-background'));
                            }
                            
                            // Scale movement based on depth and sensitivity
                            const depthFactor = Math.abs(zDepth) * 0.2 * parallaxSensitivity;
                            const moveX = deltaX * depthFactor * moveAmount;
                            const moveY = deltaY * depthFactor * moveAmount;
                            
                            // Update transform preserving existing properties
                            let newTransform = transformStyle.replace(/translate(X|Y)\([^)]*\)/g, '');
                            newTransform += ` translateX(${moveX}px) translateY(${moveY}px)`;
                            word.style.transform = newTransform;
                        });
                        
                        // Update reading cursor
                        updateReadingCursor(clientX, clientY);
                        
                        lastX = clientX;
                        lastY = clientY;
                        isMoving = false;
                    });
                    
                    isMoving = true;
                }
            }
            
            // Set up event listeners
            function setupEventListeners() {
                // Mouse movement handler
                document.addEventListener('mousemove', function(e) {
                    handleMovement(e.clientX, e.clientY);
                });
                
                // Touch movement handler with passive option for better performance
                document.addEventListener('touchmove', function(e) {
                    handleMovement(e.touches[0].clientX, e.touches[0].clientY);
                }, { passive: true });
                
                // Reset position when mouse leaves or touch ends
                document.addEventListener('mouseleave', resetPosition);
                document.addEventListener('touchend', resetPosition);
                
                // Add subtle movement on scroll for mobile
                window.addEventListener('deviceorientation', function(e) {
                    if (e.beta && e.gamma) {
                        const x = window.innerWidth / 2 + (e.gamma * 10);
                        const y = window.innerHeight / 2 + (e.beta * 10);
                        handleMovement(x, y);
                    }
                }, true);
                
                // Hide semantic map when clicking outside
                semanticMap.addEventListener('click', function(e) {
                    if (e.target === semanticMap) {
                        semanticMap.classList.remove('visible');
                    }
                });
                
                // Handle escape key to close semantic map
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape' && semanticMap.classList.contains('visible')) {
                        semanticMap.classList.remove('visible');
                    }
                });
            }
            
            function resetPosition() {
                // Smoothly reset the scene position
                textScene.style.transform = 'perspective(1200px) rotateY(0deg) rotateX(0deg) translateX(0) translateY(0)';
                
                // Reset word positions
                document.querySelectorAll('.word, .foreign-text').forEach(word => {
                    const transform = word.style.transform || '';
                    word.style.transform = transform.replace(/translate(X|Y)\([^)]*\)/g, '');
                });
                
                // Hide reading cursor
                readingCursor.classList.add('hidden');
            }
            
            // Initialize the experience
            function initialize() {
                initializeTextDepths();
                setupInterlinearText();
                setupMultiSubstitutions();
                setupTranslations();
                setupSettingsPanel();
                setupSettingsControls();
                setupEventListeners();
                
                // Apply initial settings
                updateDepthIntensity();
                updateGlowIntensity();
                updateColorScheme();
            }
            
            // Start the application
            initialize();
        });
    </script>
</body>
</html><!DOCTYPE html>
